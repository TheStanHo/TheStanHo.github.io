{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/SettingUpAPersonalSandbox/","result":{"pageContext":{"article":{"banner":{"alt":"IaC","caption":"Photo by <u><a href=\"https://unsplash.com/photos/grayscale-photo-of-person-using-macbook-_UeY8aTI6d0\">Sergey Zolkin</a></u>","src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/c68bca69496c13dc4803f93ba7618aa4/91671/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg","srcSet":"/static/c68bca69496c13dc4803f93ba7618aa4/7e3b4/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg 165w,\n/static/c68bca69496c13dc4803f93ba7618aa4/47f88/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg 330w,\n/static/c68bca69496c13dc4803f93ba7618aa4/91671/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg 660w,\n/static/c68bca69496c13dc4803f93ba7618aa4/5aaff/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg 1320w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/c68bca69496c13dc4803f93ba7618aa4/322ad/sergey-zolkin-_UeY8aTI6d0-unsplash.webp 165w,\n/static/c68bca69496c13dc4803f93ba7618aa4/de3b3/sergey-zolkin-_UeY8aTI6d0-unsplash.webp 330w,\n/static/c68bca69496c13dc4803f93ba7618aa4/2b2b5/sergey-zolkin-_UeY8aTI6d0-unsplash.webp 660w,\n/static/c68bca69496c13dc4803f93ba7618aa4/e36a7/sergey-zolkin-_UeY8aTI6d0-unsplash.webp 1320w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":400}}}},"body":"<h2>The Idea</h2>\n<p>Having been bored over the weekend, as you do of course. I thought I'd spend some time setting up my personal Azure Subscription alongside some basic infrastructure, so that in the future I can have a personal Sandbox in Azure where I can Test and refresh my knowledge of technologies. It would also be usefeul to have for when I learn for some Azure Certifications in the future (so he says).</p>\n<p>This would also actually gave me a chance to reinforce technologies that I already know or haven't used in a while.</p>\n<h2>Technology used</h2>\n<ul>\n<li>Cloud Provider - Had to be Azure of course, mainly because it has been the only cloud provider I have used and one I use for work. I signed up for their <a href=\"https://azure.microsoft.com/en-gb/free/\">Free account</a>. Since they offer $200 free Azure credit it would allow me to see how much money my sandbox environment would actually use, if I decided to upgrade to Pay-As-You-Go in future. (This is where in future I will regret and accidently rack up a bill of 10k). With Azure Pricing calulator though, I have estimated it should cost me no more than around Â£60 ~ a month if I was on Pay-As-You-Go. Deployng to East US seemed to be the cheapest option.</li>\n<li>Infrastructure as Code - I knew to help reduce costs so that I can quickly spin up and down the Sandbox environment I would need to utilise some IaC. It would also allow me to assign some roles to the service principal and managed identities so that when I spin the environment up from scratch I would have less to think about.</li>\n<li>CI/CD - For this the obvious choice was Azure DevOps. It also gave me more of a chance to test out what I have learned about Azure Yaml pipelines.</li>\n</ul>\n<h3>A Scenario - The beauty of a simple task</h3>\n<p>So I gave myself a task to come up with some useful cronjob. The Cronjob's purpose I decided was for it to scale down all my deployments at a given time. The beauty of what sounds like a simple task is that it allows me to play with different technologies and reinforce my skillset. For example to do this I used:</p>\n<ul>\n<li>Powershell - Used to script the scale down of the deployments which the cronjob ran. You can see this below</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">    <span class=\"token comment\">#Get all the deployments from the default namespace</span>\r\n    <span class=\"token variable\">$deployments</span> = kubectl get deployments <span class=\"token operator\">-</span>o jsonpath=<span class=\"token string\">'{.items[*].metadata.name}'</span>\r\n    \r\n    <span class=\"token comment\">#Convert the output string into an array</span>\r\n    <span class=\"token variable\">$deploymentArray</span> = <span class=\"token variable\">$deployments</span><span class=\"token punctuation\">.</span>Split<span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token comment\">#Scaling down each deployment</span>\r\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$deployment</span> in <span class=\"token variable\">$deploymentArray</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">Write-Output</span> <span class=\"token string\">\"Scalingdown deployment: <span class=\"token variable\">$deployment</span>\"</span>\r\n      kubectl scale <span class=\"token operator\">--</span>replicas=0 deployments/<span class=\"token variable\">$deployment</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token function\">Write-Output</span> <span class=\"token string\">\"Scaling down operation completed successfully\"</span></code></pre></div>\n<ul>\n<li>Docker - Creating a Docker image allowed me to create the cronjob with the correct \"environment\" for it to run the script.</li>\n<li>Azure Container Registry (ACR) - This was used to house my custom docker image which was deployed via Terraform</li>\n<li>Helmcharts - Allowed me to deploy the cronjob, aks secrets housing the secret I required to pull from my private ACR.</li>\n<li>AKS roles, rolebindings, service accounts - Never had to actually create these myself since these are usually created for you on the Helmcharts you get from say Artifact hub. So it was nice to learn something new to me.</li>\n</ul>\n<p>This is just an example of why something that sounds so simple can allow you to practice and refine your skillset.</p>\n<h2>The Outcome</h2>\n<p>So the outcome of my madness. I now have my infrastructure fully terraformed. It will deploy the bare minimum of what I want such as:</p>\n<ul>\n<li>Azure Kubernetes Services,</li>\n<li>Virtual Network + Network security group,</li>\n<li>Azure Container Registry,</li>\n<li>Resource permissions</li>\n</ul>\n<p>Which you can (kind of) see below. Well the resource groups anyway but I can \"Azure\" you they are thereðŸ˜‰.\r\n<figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.63636363636364%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABEUlEQVR42o2SC2/CMAyE+f9/dKOM5uE8mtrJTXagINgkIp0qq9GX89mnEAJyziAixBhNYwyMgdv3oU/Oya0rgvfgfUcXgQj/e1n/ee/gnDMT+si2bVbXWq0+rSEilopdOrgPU+P+LhlgEbhACJHQ2maAUgq892itTeBXTDhnwU9inGnHQgxXBL4K1szwRaxeC2OXgUsWpPZoP6Vkcekx4HdMWDIb6EyMS2L0/nde6n6hHbQJcMtUgTqH3vvD4VoF1zydhSpvw7jLgIknEBOo7hR4v2NAV7WtCVRJtxG/THgC9eHU+gHMOYGOzdCWA8FtcrjT7LhPwGfAuXIHcKGE61PLGvw94NcdVOeXl5afgbqHvyOswYuF97U3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b19c98032007bc87bfdc7d64c18f9a03/c9b55/Azure.webp 165w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/f2908/Azure.webp 330w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/cc661/Azure.webp 660w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/3fccf/Azure.webp 916w\"\n              sizes=\"(max-width: 660px) 100vw, 660px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b19c98032007bc87bfdc7d64c18f9a03/04c57/Azure.png 165w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/d9ecf/Azure.png 330w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/1f083/Azure.png 660w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/59822/Azure.png 916w\"\n            sizes=\"(max-width: 660px) 100vw, 660px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b19c98032007bc87bfdc7d64c18f9a03/1f083/Azure.png\"\n            alt=\"Stan&#39;s Lab\"\n            title=\"Resources deployed\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Resources deployed</p></figcaption>\n  </figure>\r\nSince this is done in Terraform I can easily spin this up and down at a click of a button (or two... approver gate you see!). With the pipelines I have set up below for infrastructure, docker builds and also helmchart deployments for such things as Prometheus/Nginx/Cronjob. All done via Azure Yaml Pipelines.\r\n<figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.06060606060606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB5klEQVR42o1U2ZKiQBDkN3YUubvpkxt0DhzFnf//o9yocpxwN2KVh4ymo4iszKyCQBQFvJU4jA3GYUDftZimAYf9hGkcGFIUyLMURZ49RVDkOfpKYpknzPOMj/c3fB5nLMsZl/MJ59MJqhTrCft+wPF0gbUO1ijE0Q7RLsQu3PJJyNKECdcgkKWCNA5CCLZGXUSR/9WV7lRbg4BULedPXJYzjvMHLsvClun8vSz4+rrg9bBH29To2uYpAur+/vbK4deVR99138WWBzT0HZw13L2U4imCJI5QSokw3GLz8oux3bwg3G74JNzn+QxBmsQosgRDbdDRyowDijzlIg3oNqT7+yOwQnqwk0PTVGjrGpW38N7CaAVnLarKofIOqpRrCGNkaQyjBYzRnBeBsqUXqE4uCLfmjwmTGHmWoB89ur7DOPRs21vLe8Ur8x04ka6yTPno0cI6Da1Kturd1bLRGt57tkw7+SzLnwxVo+C949WxZNtZSCGglOQIruRq/VDc3qEfOl5gQlNXrIoUN811ab016xRGYQjVKp7szSqpUqrk7KzRDK0VZ/qINEiiHdIigZ/8VVlTs7KbOiKu6wreGY7DWc0/i/+RBkkUIZMpTG1gtWZ118Hon8+NlNFJe0i1/J/Fvyf8A6pj7q9HyQfKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4c169e452ecc7e4a27a42256fcece4b2/c9b55/Pipelines.webp 165w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/f2908/Pipelines.webp 330w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/cc661/Pipelines.webp 660w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/6366e/Pipelines.webp 842w\"\n              sizes=\"(max-width: 660px) 100vw, 660px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4c169e452ecc7e4a27a42256fcece4b2/04c57/Pipelines.png 165w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/d9ecf/Pipelines.png 330w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/1f083/Pipelines.png 660w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/99072/Pipelines.png 842w\"\n            sizes=\"(max-width: 660px) 100vw, 660px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4c169e452ecc7e4a27a42256fcece4b2/1f083/Pipelines.png\"\n            alt=\"Azure DevOps Pipelines\"\n            title=\"Azure DevOps Pipelines\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Azure DevOps Pipelines</p></figcaption>\n  </figure></p>\n<p>All in all, it was a good mini project to do over the weekend. Which will set me up on the path of refining my skillset and having an environment to play around with. Although, depending on my cost management skills it is debatable whether I'll regret this in the long runðŸ˜….</p>","categories":["Infrastructure as Code","Terraform","Personal","Azure"],"date":"January 13, 2024","description":"Setting up a Personal Sandbox","id":"3c90b8fd-be5f-5fb0-8f66-050267b88f6a","keywords":["Infrastructure as Code","Azure","Sandbox","Terraform","Blog"],"slug":"/SettingUpAPersonalSandbox/","title":"Setting up a Personal Sandbox","readingTime":{"text":"4 min read"}},"listingPagePath":"/blog"}},"staticQueryHashes":["172304273","1764120992","2442753764","2572006233","3525841079","513457919","540466502","597217301","948380417"],"slicesMap":{}}