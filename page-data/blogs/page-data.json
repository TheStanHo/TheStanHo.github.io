{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-listing-index-tsx","path":"/blogs/","result":{"pageContext":{"articles":[{"banner":{"alt":"Metrics","caption":"Photo by <u><a href=\"https://unsplash.com/photos/turned-on-monitoring-screen-qwtCeJ5cLYs\">Stephen Dawson</a></u>","src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#585858","images":{"fallback":{"src":"/static/01a8e7547004c99cd7fcc8d5104d2f08/91671/stephen-dawson-qwtCeJ5cLYs-unsplash.jpg","srcSet":"/static/01a8e7547004c99cd7fcc8d5104d2f08/7e3b4/stephen-dawson-qwtCeJ5cLYs-unsplash.jpg 165w,\n/static/01a8e7547004c99cd7fcc8d5104d2f08/47f88/stephen-dawson-qwtCeJ5cLYs-unsplash.jpg 330w,\n/static/01a8e7547004c99cd7fcc8d5104d2f08/91671/stephen-dawson-qwtCeJ5cLYs-unsplash.jpg 660w,\n/static/01a8e7547004c99cd7fcc8d5104d2f08/5aaff/stephen-dawson-qwtCeJ5cLYs-unsplash.jpg 1320w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/01a8e7547004c99cd7fcc8d5104d2f08/322ad/stephen-dawson-qwtCeJ5cLYs-unsplash.webp 165w,\n/static/01a8e7547004c99cd7fcc8d5104d2f08/de3b3/stephen-dawson-qwtCeJ5cLYs-unsplash.webp 330w,\n/static/01a8e7547004c99cd7fcc8d5104d2f08/2b2b5/stephen-dawson-qwtCeJ5cLYs-unsplash.webp 660w,\n/static/01a8e7547004c99cd7fcc8d5104d2f08/e36a7/stephen-dawson-qwtCeJ5cLYs-unsplash.webp 1320w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":400}}}},"body":"<h2>Introduction</h2>\n<p>Having spent time in my DevOps career using Grafana and maintaining it. I've never actually had the chance to deploy it from scratch, especially the newer version. Since the versions that I have used have all been &#x3C; v9.0. I can presume that the current latest version of v10.2 probably has a lot of new features and changes.</p>\n<p>This blog is written on how I deployed Grafana and provisoned the Dashboard, Alerts, Datasources, Contact points (Since they had broken down Notifcations channels into Notification Policies and Contact Points) and Notification Policies. Luckily enough, I set up a sandbox environment as mentioned in an <a href=\"https://thestanho.github.io/SettingUpAPersonalSandbox/\">early blog</a> which I will be using to deploy Grafana too. This is far better than Minikube in my opinion as personally it tends not to work that well for me, or I'm just not well versed in the workings of it.</p>\n<ul>\n<li>The helmchart used can be found here on <a href=\"https://artifacthub.io/packages/helm/grafana/grafana\">ArtifactHub</a> or via the source on <a href=\"https://github.com/grafana/helm-charts/tree/main/charts/grafana\">Github</a></li>\n<li>The Azure DevOps Yaml pipeline I used to deploy can be found below.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">trigger</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token boolean important\">false</span>\r\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">repo</span><span class=\"token punctuation\">:</span> self\r\n<span class=\"token key atrule\">pool</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">vmImage</span><span class=\"token punctuation\">:</span> windows<span class=\"token punctuation\">-</span>latest\r\n<span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> serviceConnectionName\r\n    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;updateMe!>\"</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> resourceGroupName\r\n    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;updateMe!>\"</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> AKSClusterName\r\n    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;updateMe!>\"</span>\r\n<span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> Helm\r\n    <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> Helm\r\n    <span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span> Helm\r\n      <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Helm\"</span>\r\n      <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">task</span><span class=\"token punctuation\">:</span> HelmInstaller@0\r\n          <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Install Helm 2.14.1'</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">task</span><span class=\"token punctuation\">:</span> HelmDeploy@0\r\n          <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'helm upgrade'</span>\r\n          <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token key atrule\">azureSubscription</span><span class=\"token punctuation\">:</span> $(serviceConnectionName)\r\n            <span class=\"token key atrule\">azureResourceGroup</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'$(resourceGroupName)'</span>\r\n            <span class=\"token key atrule\">kubernetesCluster</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'$(AKSClusterName)'</span>\r\n            <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\r\n            <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> upgrade\r\n            <span class=\"token key atrule\">chartType</span><span class=\"token punctuation\">:</span> FilePath\r\n            <span class=\"token key atrule\">chartPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'grafana'</span>\r\n            <span class=\"token key atrule\">releaseName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'grafana'</span>\r\n            <span class=\"token key atrule\">arguments</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'--install'</span></code></pre></div>\n<h2>Provisioning Set up - Helmchart</h2>\n<p>To enable provisioning of the dashboards, alerts, datasources etc. We need to enable the sidecars that will help pick up the configmaps/secrets used to deploy these resources. To do this in the Grafana values.yaml enable and set the following values.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">sidecar</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">alerts</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n    <span class=\"token comment\"># label that the configmaps with alert are marked with</span>\r\n    <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> grafana_alert\r\n    <span class=\"token comment\"># value of label that the configmaps with alert are set to</span>\r\n    <span class=\"token key atrule\">labelValue</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"provision\"</span>\r\n    <span class=\"token comment\"># If specified, the sidecar will search for alert config-maps inside this namespace.</span>\r\n    <span class=\"token comment\"># Otherwise the namespace in which the sidecar is running will be used.</span>\r\n    <span class=\"token comment\"># It's also possible to specify ALL to search in all namespaces</span>\r\n    <span class=\"token key atrule\">searchNamespace</span><span class=\"token punctuation\">:</span> <span class=\"token null important\">null</span>\r\n    <span class=\"token comment\"># Method to use to detect ConfigMap changes. With WATCH the sidecar will do a WATCH requests, with SLEEP it will list all ConfigMaps, then sleep for 60 seconds.</span>\r\n    <span class=\"token key atrule\">watchMethod</span><span class=\"token punctuation\">:</span> WATCH\r\n    <span class=\"token comment\"># search in configmap, secret or both</span>\r\n    <span class=\"token key atrule\">resource</span><span class=\"token punctuation\">:</span> both\r\n  <span class=\"token key atrule\">dashboards</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n    <span class=\"token comment\"># label that the configmaps with dashboards are marked with</span>\r\n    <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> grafana_dashboard\r\n    <span class=\"token comment\"># value of label that the configmaps with dashboards are set to</span>\r\n    <span class=\"token key atrule\">labelValue</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"provision\"</span>\r\n    <span class=\"token comment\"># If specified, the sidecar will search for alert config-maps inside this namespace.</span>\r\n    <span class=\"token comment\"># Otherwise the namespace in which the sidecar is running will be used.</span>\r\n    <span class=\"token comment\"># It's also possible to specify ALL to search in all namespaces</span>\r\n    <span class=\"token key atrule\">searchNamespace</span><span class=\"token punctuation\">:</span> <span class=\"token null important\">null</span>\r\n    <span class=\"token comment\"># Method to use to detect ConfigMap changes. With WATCH the sidecar will do a WATCH requests, with SLEEP it will list all ConfigMaps, then sleep for 60 seconds.</span>\r\n    <span class=\"token key atrule\">watchMethod</span><span class=\"token punctuation\">:</span> WATCH\r\n    <span class=\"token comment\"># search in configmap, secret or both</span>\r\n    <span class=\"token key atrule\">resource</span><span class=\"token punctuation\">:</span> both\r\n    <span class=\"token comment\"># If specified, the sidecar will look for annotation with this name to create folder and put graph here.</span>\r\n    <span class=\"token comment\"># You can use this parameter together with `provider.foldersFromFilesStructure`to annotate configmaps and create folder structure.</span>\r\n    <span class=\"token key atrule\">folderAnnotation</span><span class=\"token punctuation\">:</span> grafana_dashboard_folder\r\n    <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token comment\"># disableDelete to activate a import-only behaviour</span>\r\n      <span class=\"token key atrule\">disableDelete</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n      <span class=\"token comment\"># allow updating provisioned dashboards from the UI</span>\r\n      <span class=\"token key atrule\">allowUiUpdates</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\r\n      <span class=\"token comment\"># allow Grafana to replicate dashboard structure from filesystem</span>\r\n      <span class=\"token key atrule\">foldersFromFilesStructure</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n  <span class=\"token key atrule\">datasources</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n    <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> grafana_datasource\r\n    <span class=\"token comment\"># value of label that the configmaps with datasources are set to</span>\r\n    <span class=\"token key atrule\">labelValue</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"provision\"</span>\r\n    <span class=\"token comment\"># Log level. Can be one of: DEBUG, INFO, WARN, ERROR, CRITICAL.</span>\r\n    <span class=\"token comment\"># logLevel: INFO</span>\r\n    <span class=\"token comment\"># If specified, the sidecar will search for datasource config-maps inside this namespace.</span>\r\n    <span class=\"token comment\"># Otherwise the namespace in which the sidecar is running will be used.</span>\r\n    <span class=\"token comment\"># It's also possible to specify ALL to search in all namespaces</span>\r\n    <span class=\"token key atrule\">searchNamespace</span><span class=\"token punctuation\">:</span> <span class=\"token null important\">null</span>\r\n    <span class=\"token comment\"># Method to use to detect ConfigMap changes. With WATCH the sidecar will do a WATCH requests, with SLEEP it will list all ConfigMaps, then sleep for 60 seconds.</span>\r\n    <span class=\"token key atrule\">watchMethod</span><span class=\"token punctuation\">:</span> WATCH\r\n    <span class=\"token comment\"># search in configmap, secret or both</span>\r\n    <span class=\"token key atrule\">resource</span><span class=\"token punctuation\">:</span> both</code></pre></div>\n<p><strong>Note</strong>: I don't install the plugin's via this method since as it staes in their documentation (yes sometimes I actually read it) <a href=\"https://grafana.com/docs/grafana/latest/administration/provisioning/#plugins\">here</a>, that the feature enables the provisioning of plugin configuration but not of the plugins themselves, so it is just easier to set the required plugins in the values.yaml.</p>\n<p>So above is just the main configuration that I set in the values.yaml for the Grafana helmchart to allow me to provsion via configmaps and secrets. Things I've learned when trying to do so:</p>\n<ol>\n<li>Remember to set the labelValue, this is important for the sidecar to pick up the configmap or secret. I believe in the values.yaml they left it as \"\" blank so you have to set is value and match it with the label value you set for your configmap/secret.</li>\n<li>I found it useful to just manually create the bits I required in Grafana and then exported the yaml of it to help set the yaml that I required.</li>\n</ol>\n<h2>Provisoning the Grafana resources</h2>\n<h3>Dashboard</h3>\n<p>One thing to remember for this is that if you want to put your dashboard in a specific folder then add the annotation <em>\"grafana_dashboard_folder\"</em> and make sure that in the values.yaml file, that your <em>\"folderAnnotation\"</em> value is set</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\r\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\r\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dashboard<span class=\"token punctuation\">-</span>one\r\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n     <span class=\"token key atrule\">grafana_dashboard</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"provision\"</span>\r\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span> \r\n    <span class=\"token key atrule\">grafana_dashboard_folder</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Dashboard one\"</span>\r\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">dashboard-one.json</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\r\n    &lt;Dashboard.json file contents here<span class=\"token punctuation\">></span></code></pre></div>\n<h3>Datasource</h3>\n<p>To test this I actually deployed a <a href=\"https://github.com/prometheus-community/helm-charts\">Prometheus</a> instance on my AKS, so that I have a working datasource I could actually add to it.</p>\n<p><a href=\"https://grafana.com/docs/grafana/latest/datasources/\">Documentation about datasources</a>. Helpful documentation with core datasources and also links to how to provsion them.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\r\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\r\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> datasources\r\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">grafana_datasource</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'provision'</span> \r\n<span class=\"token key atrule\">stringData</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">datasources.yaml</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\r\n    <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\r\n    <span class=\"token key atrule\">datasources</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Prometheus<span class=\"token punctuation\">-</span>Production\r\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> prometheus\r\n        <span class=\"token comment\"># Access mode - proxy (server in the UI) or direct (browser in the UI).</span>\r\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//10.244.0.38<span class=\"token punctuation\">:</span><span class=\"token number\">9090</span>\r\n        <span class=\"token key atrule\">jsonData</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">httpMethod</span><span class=\"token punctuation\">:</span> POST\r\n          <span class=\"token key atrule\">manageAlerts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n          <span class=\"token key atrule\">prometheusType</span><span class=\"token punctuation\">:</span> Prometheus\r\n          <span class=\"token comment\">#prometheusVersion: 2.44.0</span>\r\n          <span class=\"token key atrule\">cacheLevel</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'low'</span>\r\n          <span class=\"token key atrule\">disableRecordingRules</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\r\n          <span class=\"token key atrule\">incrementalQueryOverlapWindow</span><span class=\"token punctuation\">:</span> 10m\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Prometheus<span class=\"token punctuation\">-</span>Test\r\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> prometheus\r\n        <span class=\"token comment\"># Access mode - proxy (server in the UI) or direct (browser in the UI).</span>\r\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//10.244.0.38<span class=\"token punctuation\">:</span><span class=\"token number\">9090</span>\r\n        <span class=\"token key atrule\">jsonData</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">httpMethod</span><span class=\"token punctuation\">:</span> POST\r\n          <span class=\"token key atrule\">manageAlerts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n          <span class=\"token key atrule\">prometheusType</span><span class=\"token punctuation\">:</span> Prometheus\r\n          <span class=\"token comment\">#prometheusVersion: 2.44.0</span>\r\n          <span class=\"token key atrule\">cacheLevel</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'low'</span>\r\n          <span class=\"token key atrule\">disableRecordingRules</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\r\n          <span class=\"token key atrule\">incrementalQueryOverlapWindow</span><span class=\"token punctuation\">:</span> 10m</code></pre></div>\n<h3>Alerts</h3>\n<p><strong>Note:</strong> Make sure to label your alert when creating it! To be used in the notification policies!</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\r\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\r\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana<span class=\"token punctuation\">-</span>alert\r\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n     <span class=\"token key atrule\">grafana_alert</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"provision\"</span>\r\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">alerts.yaml</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\r\n        <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\r\n        <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">orgId</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\r\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Alerts<span class=\"token punctuation\">-</span>Test\r\n            <span class=\"token key atrule\">folder</span><span class=\"token punctuation\">:</span> Alerting Dashboards\r\n            <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 5m\r\n            <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uid</span><span class=\"token punctuation\">:</span> &lt;UID<span class=\"token punctuation\">></span>\r\n                <span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> Alert<span class=\"token punctuation\">-</span>Demo\r\n                <span class=\"token key atrule\">condition</span><span class=\"token punctuation\">:</span> C\r\n                <span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\r\n                    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">refId</span><span class=\"token punctuation\">:</span> A\r\n                    <span class=\"token key atrule\">relativeTimeRange</span><span class=\"token punctuation\">:</span>\r\n                        <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span> <span class=\"token number\">600</span>\r\n                        <span class=\"token key atrule\">to</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\r\n                    <span class=\"token key atrule\">datasourceUid</span><span class=\"token punctuation\">:</span> &lt;datasourceUID<span class=\"token punctuation\">></span>\r\n                    <span class=\"token key atrule\">model</span><span class=\"token punctuation\">:</span>\r\n                        <span class=\"token key atrule\">disableTextWrap</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\r\n                        <span class=\"token key atrule\">editorMode</span><span class=\"token punctuation\">:</span> builder\r\n                        <span class=\"token key atrule\">expr</span><span class=\"token punctuation\">:</span> aggregator_discovery_aggregation_count_total<span class=\"token punctuation\">{</span>agentpool=\"default\"<span class=\"token punctuation\">}</span>\r\n                        <span class=\"token key atrule\">fullMetaSearch</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\r\n                        <span class=\"token key atrule\">includeNullMetadata</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n                        <span class=\"token key atrule\">instant</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n                        <span class=\"token key atrule\">intervalMs</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\r\n                        <span class=\"token key atrule\">legendFormat</span><span class=\"token punctuation\">:</span> __auto\r\n                        <span class=\"token key atrule\">maxDataPoints</span><span class=\"token punctuation\">:</span> <span class=\"token number\">43200</span>\r\n                        <span class=\"token key atrule\">range</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\r\n                        <span class=\"token key atrule\">refId</span><span class=\"token punctuation\">:</span> A\r\n                        <span class=\"token key atrule\">useBackend</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\r\n                    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">refId</span><span class=\"token punctuation\">:</span> B\r\n                    <span class=\"token key atrule\">relativeTimeRange</span><span class=\"token punctuation\">:</span>\r\n                        <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span> <span class=\"token number\">600</span>\r\n                        <span class=\"token key atrule\">to</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\r\n                    <span class=\"token key atrule\">datasourceUid</span><span class=\"token punctuation\">:</span> __expr__\r\n                    <span class=\"token key atrule\">model</span><span class=\"token punctuation\">:</span>\r\n                        <span class=\"token key atrule\">conditions</span><span class=\"token punctuation\">:</span>\r\n                            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">evaluator</span><span class=\"token punctuation\">:</span>\r\n                                <span class=\"token key atrule\">params</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n                                <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> gt\r\n                            <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span>\r\n                                <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> and\r\n                            <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span>\r\n                                <span class=\"token key atrule\">params</span><span class=\"token punctuation\">:</span>\r\n                                    <span class=\"token punctuation\">-</span> B\r\n                            <span class=\"token key atrule\">reducer</span><span class=\"token punctuation\">:</span>\r\n                                <span class=\"token key atrule\">params</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n                                <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> last\r\n                            <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> query\r\n                        <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span>\r\n                            <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> __expr__\r\n                            <span class=\"token key atrule\">uid</span><span class=\"token punctuation\">:</span> __expr__\r\n                        <span class=\"token key atrule\">expression</span><span class=\"token punctuation\">:</span> A\r\n                        <span class=\"token key atrule\">intervalMs</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\r\n                        <span class=\"token key atrule\">maxDataPoints</span><span class=\"token punctuation\">:</span> <span class=\"token number\">43200</span>\r\n                        <span class=\"token key atrule\">reducer</span><span class=\"token punctuation\">:</span> last\r\n                        <span class=\"token key atrule\">refId</span><span class=\"token punctuation\">:</span> B\r\n                        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> reduce\r\n                    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">refId</span><span class=\"token punctuation\">:</span> C\r\n                    <span class=\"token key atrule\">relativeTimeRange</span><span class=\"token punctuation\">:</span>\r\n                        <span class=\"token key atrule\">from</span><span class=\"token punctuation\">:</span> <span class=\"token number\">600</span>\r\n                        <span class=\"token key atrule\">to</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\r\n                    <span class=\"token key atrule\">datasourceUid</span><span class=\"token punctuation\">:</span> __expr__\r\n                    <span class=\"token key atrule\">model</span><span class=\"token punctuation\">:</span>\r\n                        <span class=\"token key atrule\">conditions</span><span class=\"token punctuation\">:</span>\r\n                            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">evaluator</span><span class=\"token punctuation\">:</span>\r\n                                <span class=\"token key atrule\">params</span><span class=\"token punctuation\">:</span>\r\n                                    <span class=\"token punctuation\">-</span> <span class=\"token number\">0</span>\r\n                                <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> gt\r\n                            <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span>\r\n                                <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> and\r\n                            <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span>\r\n                                <span class=\"token key atrule\">params</span><span class=\"token punctuation\">:</span>\r\n                                    <span class=\"token punctuation\">-</span> C\r\n                            <span class=\"token key atrule\">reducer</span><span class=\"token punctuation\">:</span>\r\n                                <span class=\"token key atrule\">params</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n                                <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> last\r\n                            <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> query\r\n                        <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span>\r\n                            <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> __expr__\r\n                            <span class=\"token key atrule\">uid</span><span class=\"token punctuation\">:</span> __expr__\r\n                        <span class=\"token key atrule\">expression</span><span class=\"token punctuation\">:</span> B\r\n                        <span class=\"token key atrule\">intervalMs</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\r\n                        <span class=\"token key atrule\">maxDataPoints</span><span class=\"token punctuation\">:</span> <span class=\"token number\">43200</span>\r\n                        <span class=\"token key atrule\">refId</span><span class=\"token punctuation\">:</span> C\r\n                        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> threshold\r\n                <span class=\"token key atrule\">noDataState</span><span class=\"token punctuation\">:</span> NoData\r\n                <span class=\"token key atrule\">execErrState</span><span class=\"token punctuation\">:</span> Error\r\n                <span class=\"token key atrule\">for</span><span class=\"token punctuation\">:</span> 5m\r\n                <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\r\n                    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\r\n                    <span class=\"token key atrule\">runbook_url</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\r\n                    <span class=\"token key atrule\">summary</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\r\n                <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n                    <span class=\"token key atrule\">\"\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\r\n                    <span class=\"token key atrule\">team</span><span class=\"token punctuation\">:</span> Marvel\r\n                <span class=\"token key atrule\">isPaused</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<h3>Contact Points</h3>\n<p>Contact points is basically your notification channels, from legacy Grafana. Since Notifications channels were split into Contact Points and Notification Policy.\r\n<a href=\"https://grafana.com/docs/grafana/latest/alerting/fundamentals/contact-points/#contact-points\">Documentation on contact points</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\r\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\r\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> contact<span class=\"token punctuation\">-</span>point\r\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">grafana_alert</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"provision\"</span> \r\n<span class=\"token key atrule\">stringData</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">contact-points.yaml</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\r\n    <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\r\n    <span class=\"token key atrule\">contactPoints</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">orgId</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\r\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Team<span class=\"token punctuation\">-</span>Marvel\r\n          <span class=\"token key atrule\">receivers</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uid</span><span class=\"token punctuation\">:</span> Team<span class=\"token punctuation\">-</span>Marvel\r\n              <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> email\r\n              <span class=\"token key atrule\">settings</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> Team<span class=\"token punctuation\">-</span>Marvel@hotmail.co.uk\r\n                <span class=\"token key atrule\">singleEmail</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n              <span class=\"token key atrule\">disableResolveMessage</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">orgId</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\r\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Team<span class=\"token punctuation\">-</span>DC\r\n          <span class=\"token key atrule\">receivers</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uid</span><span class=\"token punctuation\">:</span> Team<span class=\"token punctuation\">-</span>DC\r\n              <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> email\r\n              <span class=\"token key atrule\">settings</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> Team<span class=\"token punctuation\">-</span>DC@hotmail.co.uk\r\n                <span class=\"token key atrule\">singleEmail</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n              <span class=\"token key atrule\">disableResolveMessage</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<h3>Notification Policies</h3>\n<p>You see here for notification policies I have <em>\"object_matchers\"</em> which will link the notification policy to the alert that was created. Hence, why it is important to label you alerts, so you can help define which notification policy route it is routed to and to which contact point.\r\n<a href=\"https://grafana.com/docs/grafana/latest/alerting/fundamentals/notification-policies/#notification-policies\">Documentation on Notification Policies</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\r\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\r\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> notification<span class=\"token punctuation\">-</span>policies\r\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">grafana_alert</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"provision\"</span> \r\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">notification-policies.yaml</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\r\n    <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\r\n    <span class=\"token key atrule\">policies</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">orgId</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\r\n        <span class=\"token key atrule\">receiver</span><span class=\"token punctuation\">:</span> grafana<span class=\"token punctuation\">-</span>default<span class=\"token punctuation\">-</span>email\r\n        <span class=\"token key atrule\">group_by</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'...'</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">receiver</span><span class=\"token punctuation\">:</span> Team<span class=\"token punctuation\">-</span>Marvel\r\n            <span class=\"token key atrule\">object_matchers</span><span class=\"token punctuation\">:</span>\r\n              <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'team'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'='</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Marvel'</span><span class=\"token punctuation\">]</span>\r\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">receiver</span><span class=\"token punctuation\">:</span> Team<span class=\"token punctuation\">-</span>DC\r\n            <span class=\"token key atrule\">object_matchers</span><span class=\"token punctuation\">:</span>\r\n              <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'team'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'='</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DC'</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Conclusion</h2>\n<p>Personally, I've learned quite alot trying to implement this in my sandbox. I've learned how the new Grafana version works especially with the new way that alerting is implemented with the newer version of Grafana. I've also noticed it will be such a pain to migrate old dashboards on older versions of Grafana to newer Versions of Grafana. (Although, hopefully there is some documentation I missed talking about such a migration!).</p>\n<p>Also, with this kind of provisioning of such dashboards and alerts via configmaps it could allow development teams to provsion their own dashboards as part of their Helm releases so that as well as deploying their app they have a way of monitoring and alerting set up also for their applications.</p>","categories":["Monitoring","AKS","Kubernetes"],"date":"January 20, 2024","description":"Grafana Provisioning via helmcharts","id":"596815bb-ebd2-5a0d-926d-7b6c0e3a887f","keywords":["Monitoring","Grafana","Kubernetes","AKS","Provisioning","Blog"],"slug":"/GrafanaProvisioning/","title":"Provisioning Grafana (v10.2)","readingTime":{"text":"8 min read"}},{"banner":{"alt":"IaC","caption":"Photo by <u><a href=\"https://unsplash.com/photos/grayscale-photo-of-person-using-macbook-_UeY8aTI6d0\">Sergey Zolkin</a></u>","src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/c68bca69496c13dc4803f93ba7618aa4/91671/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg","srcSet":"/static/c68bca69496c13dc4803f93ba7618aa4/7e3b4/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg 165w,\n/static/c68bca69496c13dc4803f93ba7618aa4/47f88/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg 330w,\n/static/c68bca69496c13dc4803f93ba7618aa4/91671/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg 660w,\n/static/c68bca69496c13dc4803f93ba7618aa4/5aaff/sergey-zolkin-_UeY8aTI6d0-unsplash.jpg 1320w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/c68bca69496c13dc4803f93ba7618aa4/322ad/sergey-zolkin-_UeY8aTI6d0-unsplash.webp 165w,\n/static/c68bca69496c13dc4803f93ba7618aa4/de3b3/sergey-zolkin-_UeY8aTI6d0-unsplash.webp 330w,\n/static/c68bca69496c13dc4803f93ba7618aa4/2b2b5/sergey-zolkin-_UeY8aTI6d0-unsplash.webp 660w,\n/static/c68bca69496c13dc4803f93ba7618aa4/e36a7/sergey-zolkin-_UeY8aTI6d0-unsplash.webp 1320w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":400}}}},"body":"<h2>The Idea</h2>\n<p>Having been bored over the weekend, as you do of course. I thought I'd spend some time setting up my personal Azure Subscription alongside some basic infrastructure, so that in the future I can have a personal Sandbox in Azure where I can test, refresh and reinforce my knowledge of technologies in my arsenal. It would also be useful to have for when I start to work towards some Azure Certifications in the future (so he says).</p>\n<h2>Technology used</h2>\n<ul>\n<li>Cloud Provider - Had to be Azure of course, mainly because it has been the only cloud provider I have used and one I use for work. I signed up for their <a href=\"https://azure.microsoft.com/en-gb/free/\">Free account</a>. Since they offer $200 free Azure credit it would allow me to see how much money my sandbox environment would actually use, if I decided to upgrade to Pay-As-You-Go in future. (This is where in future I will regret and accidently rack up a bill of £10k). With Azure Pricing calulator though, I have estimated it should cost me no more than around £60 ~ a month if I was on Pay-As-You-Go, when deployng to East US which seems to be the cheapest option.</li>\n<li>Infrastructure as Code - I knew to help reduce costs so that I can quickly spin up and down the Sandbox environment I would need to utilise some IaC. It would also allow me to assign some roles to the service principal and managed identities so that when I spin the environment up from scratch I would have less to think about.</li>\n<li>CI/CD - For this the obvious choice was Azure DevOps. It also gave me more of a chance to test out what I have learned about Azure Yaml pipelines.</li>\n</ul>\n<h3>A Scenario - The beauty of a simple task</h3>\n<p>So I gave myself a task to come up with some useful cronjob. The Cronjob's purpose I decided was for it to scale down all my deployments at a given time. The beauty of what sounds like a simple task is that it allows me to play with different technologies and reinforce my skillset. For example to do this I used:</p>\n<ul>\n<li>Powershell - Used to script the scale down of the deployments which the cronjob ran. You can see this below</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">    <span class=\"token comment\">#Get all the deployments from the default namespace</span>\r\n    <span class=\"token variable\">$deployments</span> = kubectl get deployments <span class=\"token operator\">-</span>o jsonpath=<span class=\"token string\">'{.items[*].metadata.name}'</span>\r\n    \r\n    <span class=\"token comment\">#Convert the output string into an array</span>\r\n    <span class=\"token variable\">$deploymentArray</span> = <span class=\"token variable\">$deployments</span><span class=\"token punctuation\">.</span>Split<span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token comment\">#Scaling down each deployment</span>\r\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$deployment</span> in <span class=\"token variable\">$deploymentArray</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">Write-Output</span> <span class=\"token string\">\"Scalingdown deployment: <span class=\"token variable\">$deployment</span>\"</span>\r\n      kubectl scale <span class=\"token operator\">--</span>replicas=0 deployments/<span class=\"token variable\">$deployment</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token function\">Write-Output</span> <span class=\"token string\">\"Scaling down operation completed successfully\"</span></code></pre></div>\n<ul>\n<li>Docker - Creating a Docker image allowed me to create the cronjob with the correct \"environment\" for it to run the script.</li>\n<li>Azure Container Registry (ACR) - This was used to house my custom docker image which was deployed via Terraform</li>\n<li>Helmcharts - Allowed me to deploy the cronjob, aks secrets housing the secret I required to pull from my private ACR.</li>\n<li>AKS roles, rolebindings, service accounts - Never had to actually create these myself since these are usually created for you on the Helmcharts you get from say Artifact hub. So it was nice to learn something new to me.</li>\n</ul>\n<p>This is just an example of why something that sounds so simple can allow you to practice and refine your skillset.</p>\n<h2>The Outcome</h2>\n<p>So the outcome of my madness. I now have my infrastructure fully terraformed. It will deploy the bare minimum of what I want such as:</p>\n<ul>\n<li>Azure Kubernetes Services,</li>\n<li>Virtual Network + Network security group,</li>\n<li>Azure Container Registry,</li>\n<li>Resource permissions</li>\n</ul>\n<p>Which you can (kind of) see below. Well the resource groups anyway but I can \"Azure\" you they are there😉.\r\n<figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.63636363636364%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABEUlEQVR42o2SC2/CMAyE+f9/dKOM5uE8mtrJTXagINgkIp0qq9GX89mnEAJyziAixBhNYwyMgdv3oU/Oya0rgvfgfUcXgQj/e1n/ee/gnDMT+si2bVbXWq0+rSEilopdOrgPU+P+LhlgEbhACJHQ2maAUgq892itTeBXTDhnwU9inGnHQgxXBL4K1szwRaxeC2OXgUsWpPZoP6Vkcekx4HdMWDIb6EyMS2L0/nde6n6hHbQJcMtUgTqH3vvD4VoF1zydhSpvw7jLgIknEBOo7hR4v2NAV7WtCVRJtxG/THgC9eHU+gHMOYGOzdCWA8FtcrjT7LhPwGfAuXIHcKGE61PLGvw94NcdVOeXl5afgbqHvyOswYuF97U3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b19c98032007bc87bfdc7d64c18f9a03/c9b55/Azure.webp 165w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/f2908/Azure.webp 330w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/cc661/Azure.webp 660w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/3fccf/Azure.webp 916w\"\n              sizes=\"(max-width: 660px) 100vw, 660px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b19c98032007bc87bfdc7d64c18f9a03/04c57/Azure.png 165w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/d9ecf/Azure.png 330w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/1f083/Azure.png 660w,\n/static/b19c98032007bc87bfdc7d64c18f9a03/59822/Azure.png 916w\"\n            sizes=\"(max-width: 660px) 100vw, 660px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b19c98032007bc87bfdc7d64c18f9a03/1f083/Azure.png\"\n            alt=\"Stan&#39;s Lab\"\n            title=\"Resources deployed\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Resources deployed</p></figcaption>\n  </figure>\r\nSince this is done in Terraform I can easily spin this up and down at a click of a button (or two... approver gate you see!). With the pipelines I have set up below for infrastructure, docker builds and also helmchart deployments for such things as Prometheus/Nginx/Cronjob. All done via Azure Yaml Pipelines.\r\n<figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.06060606060606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB5klEQVR42o1U2ZKiQBDkN3YUubvpkxt0DhzFnf//o9yocpxwN2KVh4ymo4iszKyCQBQFvJU4jA3GYUDftZimAYf9hGkcGFIUyLMURZ49RVDkOfpKYpknzPOMj/c3fB5nLMsZl/MJ59MJqhTrCft+wPF0gbUO1ijE0Q7RLsQu3PJJyNKECdcgkKWCNA5CCLZGXUSR/9WV7lRbg4BULedPXJYzjvMHLsvClun8vSz4+rrg9bBH29To2uYpAur+/vbK4deVR99138WWBzT0HZw13L2U4imCJI5QSokw3GLz8oux3bwg3G74JNzn+QxBmsQosgRDbdDRyowDijzlIg3oNqT7+yOwQnqwk0PTVGjrGpW38N7CaAVnLarKofIOqpRrCGNkaQyjBYzRnBeBsqUXqE4uCLfmjwmTGHmWoB89ur7DOPRs21vLe8Ur8x04ka6yTPno0cI6Da1Kturd1bLRGt57tkw7+SzLnwxVo+C949WxZNtZSCGglOQIruRq/VDc3qEfOl5gQlNXrIoUN811ab016xRGYQjVKp7szSqpUqrk7KzRDK0VZ/qINEiiHdIigZ/8VVlTs7KbOiKu6wreGY7DWc0/i/+RBkkUIZMpTG1gtWZ118Hon8+NlNFJe0i1/J/Fvyf8A6pj7q9HyQfKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4c169e452ecc7e4a27a42256fcece4b2/c9b55/Pipelines.webp 165w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/f2908/Pipelines.webp 330w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/cc661/Pipelines.webp 660w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/6366e/Pipelines.webp 842w\"\n              sizes=\"(max-width: 660px) 100vw, 660px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4c169e452ecc7e4a27a42256fcece4b2/04c57/Pipelines.png 165w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/d9ecf/Pipelines.png 330w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/1f083/Pipelines.png 660w,\n/static/4c169e452ecc7e4a27a42256fcece4b2/99072/Pipelines.png 842w\"\n            sizes=\"(max-width: 660px) 100vw, 660px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4c169e452ecc7e4a27a42256fcece4b2/1f083/Pipelines.png\"\n            alt=\"Azure DevOps Pipelines\"\n            title=\"Azure DevOps Pipelines\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Azure DevOps Pipelines</p></figcaption>\n  </figure></p>\n<p>All in all, it was a good mini project to do over the weekend. Which will set me up on the path of refining my skillset and having an environment to play around with. Although, depending on my cost management skills it is debatable whether I'll regret this in the long run😅.</p>","categories":["Infrastructure as Code","Terraform","Personal","Azure"],"date":"January 13, 2024","description":"Setting up a Personal Sandbox","id":"3c90b8fd-be5f-5fb0-8f66-050267b88f6a","keywords":["Infrastructure as Code","Azure","Sandbox","Terraform","Blog"],"slug":"/SettingUpAPersonalSandbox/","title":"Setting up a Personal Sandbox","readingTime":{"text":"4 min read"}},{"banner":{"alt":"Prometheus Greek God","caption":"Photo by <u><a href=\"https://unsplash.com/photos/PkZo8mERNak\">Christian Paul Stobbe</a></u>","src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#784828","images":{"fallback":{"src":"/static/70d1bcd6001188efae8641ddab2f4531/91671/christian-paul-stobbe-PkZo8mERNak-unsplash.jpg","srcSet":"/static/70d1bcd6001188efae8641ddab2f4531/7e3b4/christian-paul-stobbe-PkZo8mERNak-unsplash.jpg 165w,\n/static/70d1bcd6001188efae8641ddab2f4531/47f88/christian-paul-stobbe-PkZo8mERNak-unsplash.jpg 330w,\n/static/70d1bcd6001188efae8641ddab2f4531/91671/christian-paul-stobbe-PkZo8mERNak-unsplash.jpg 660w,\n/static/70d1bcd6001188efae8641ddab2f4531/5aaff/christian-paul-stobbe-PkZo8mERNak-unsplash.jpg 1320w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/70d1bcd6001188efae8641ddab2f4531/322ad/christian-paul-stobbe-PkZo8mERNak-unsplash.webp 165w,\n/static/70d1bcd6001188efae8641ddab2f4531/de3b3/christian-paul-stobbe-PkZo8mERNak-unsplash.webp 330w,\n/static/70d1bcd6001188efae8641ddab2f4531/2b2b5/christian-paul-stobbe-PkZo8mERNak-unsplash.webp 660w,\n/static/70d1bcd6001188efae8641ddab2f4531/e36a7/christian-paul-stobbe-PkZo8mERNak-unsplash.webp 1320w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":400}}}},"body":"<p>Each of us manages multiple AKS clusters across various environments, and we want Prometheus to monitor them. One of the challenges we face is effectively monitoring environments with multiple clusters, which can be the case in certain test or production environments(hopefully).</p>\n<p>Though there are solutions such as:</p>\n<ul>\n<li>Prometheus Federation</li>\n<li>Thanos (Not the Marvel one!)</li>\n</ul>\n<p>The simplest option I came across is the Prometheus agent introduced in Prometheus version 2.32.0. The agent mode deactivates certain features typically present in the Prometheus server, focusing solely on discovery, scraping, and remote write functions. This design choice is aimed at enhancing the performance of the Prometheus agent.</p>\n<h2>Overview of the set up</h2>\n<p>In my opinion and experience the best way to implement this is shown in the diagram below.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 529px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 115.75757575757576%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC2ElEQVR42pWV22sUVxzH9y/tu4X64otPffGhQqUiiISAUEkLlkZFEMSkFIW2PgRtHhqSZjEX3E02yV5mZ86ZOfdPOWcycZPdEXuGw7nM7/eb7/d3mw5ACIGrY9Hdl4xOUky6gT+f9fjjyXFtMD7hy+YsgE6zcc6z+v0Oj7/r4l0Dcx5BWHA9y6bz6Queve4Rvf0jKq1wVqOURhuD1uZ81RhTT6UUJsp5vxihNhYw/LVdcWd1wu7HkuA0hZBIWc+yrNBa8Wg94+GrglzED9s2gy4ZfP625Nr9Ee+7Epwiy3LyPGc6zRFCIMuSWz8P+XYlIys03tl2H0YUk8mYre4RpSxaIzk4m9AfTDC6wrQhNNaBN7zcKLj35ITTcYk1kbJIyIpCUJWS8bTkx7Upz99Kgq9922oweM3yS8H1pQkHgwpnFXkRjRXkeYGqJP1TwY3lIbd/yXDOYEwbZe8RouDD4QnvtvqIIl9IN9Lc2R/RG0yRUrRTds4hUiQlUuQposbUlCLdmDJxr7QBbwneJhnbZjCu8aW17nzaZDCuo9H4PAfru5SXun43VymfDu21G5P4c2OuUmZpW2/wOIxtKsMwzXNUpKzrO+sMPth6vVopF4cAxik21j7yYmkPWRictzXN5Ip6H/AcH2Q8vbtLd3NEwJHUr/owRdAZfvtpj4c3txCZm2sQjejB1pgH32yy+frskkC0lRDWQTB4VzI8GdLbH6Zm0QhdbVUxL/f+PeZ0cIK3VXJFdNcF5Vjw41zx65spu31FCBrnw5zDm71NypZMWLYPS5yzlFXVUI6Smn8ODV/dGbHye5nO1vlWg0oZCDbJfn1/RLdvk07E0GnSYpIVrG8M+dDLqCqJD+0IY6uLre313xk/rJ5yNilTbwyNwapSVAmyTo1VCDmXsJco27pKjC5xRiYA8Xzhw+jQ2J0rVXdpM9NBFhmMayrDGZ2LoHzu7/Z//4Yxbf4DM0X4mnEbii0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7030183aff8264f9d9315bfb22579b84/c9b55/GenericArchitecture1.webp 165w,\n/static/7030183aff8264f9d9315bfb22579b84/f2908/GenericArchitecture1.webp 330w,\n/static/7030183aff8264f9d9315bfb22579b84/820bc/GenericArchitecture1.webp 529w\"\n              sizes=\"(max-width: 529px) 100vw, 529px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7030183aff8264f9d9315bfb22579b84/04c57/GenericArchitecture1.png 165w,\n/static/7030183aff8264f9d9315bfb22579b84/d9ecf/GenericArchitecture1.png 330w,\n/static/7030183aff8264f9d9315bfb22579b84/67d6a/GenericArchitecture1.png 529w\"\n            sizes=\"(max-width: 529px) 100vw, 529px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7030183aff8264f9d9315bfb22579b84/67d6a/GenericArchitecture1.png\"\n            alt=\"Prometheus architecture\"\n            title=\"Example of Advised architecture\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Example of Advised architecture</p></figcaption>\n  </figure></p>\n<p>In this model we will have:</p>\n<ul>\n<li>2 Instances of Prometheus Server -> One for Production and another for Non-production. You can run this on the same AKS or separate it if you want to split your non-prod and prod metrics.</li>\n<li>2 Instances of InfluxDB -> One for Production Prometheus server to remote write to and another for Non-production prometheus instance to remote write to. (Note that you are not restricted to InfluxDB and there are other options to use as Remote Endpoints and storage which can be found <a href=\"https://prometheus.io/docs/operating/integrations/#remote-endpoints-and-storage\">here</a>). Again you can run this on the same AKS or separate it if you want to split your non-prod and prod metrics.</li>\n<li>Multiple Prometheus agents that are set up in different environments to remoteWrite to our Prometheus Servers respectively.</li>\n</ul>\n<h2>Implementation</h2>\n<p>In this scenario we will already have set up an InfluxDB for Prometheus Server to write to. You can use this <a href=\"https://artifacthub.io/packages/helm/influxdata/influxdb\">InfluxDB Helmchart</a>, if you want to implement using InfluxDB as your remote endpoint and storage or use an alernative solution as mentioned in the previous section.</p>\n<ul>\n<li><a href=\"https://artifacthub.io/packages/helm/prometheus-community/prometheus\">Prometheus Helmchart</a></li>\n</ul>\n<h3>Prometheus Server configuration values</h3>\n<p>The below configuration does the following:</p>\n<ul>\n<li>The <a href=\"https://prometheus.io/docs/prometheus/latest/feature_flags/#remote-write-receiver\">web.enable-remote-write-receiver</a> enables the the /api/v1/write endpoint on the Prometheus Server</li>\n<li>Ingress is set up so that the Prometheus agent has a nice url to write to</li>\n<li>RemoteWrite and RemoteRead so that Prometheus server knows where to write and read too. Allowing us to retain data even with Prometheus restart. One thing to note is that if the Prometheus server cannot write to InfluxDB it will write and read data locally to/from the pod itself, the default retention is set to 15 days. So you will only get data for 15 days until the issue with writing to InfluxDB is resolved.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">extraFlags</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> web.enable<span class=\"token punctuation\">-</span>remote<span class=\"token punctuation\">-</span>write<span class=\"token punctuation\">-</span>receiver\r\n  <span class=\"token key atrule\">ingress</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n    <span class=\"token key atrule\">tls</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> tls <span class=\"token comment\">#secretName holding the TLS certificate information</span>\r\n        <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token punctuation\">-</span> prometheus<span class=\"token punctuation\">-</span>server.&lt;domain<span class=\"token punctuation\">></span>\r\n    <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> prometheus<span class=\"token punctuation\">-</span>server.&lt;domain<span class=\"token punctuation\">></span>\r\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">kubernetes.io/ingress.class</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"nginx\"</span>\r\n  <span class=\"token key atrule\">remoteWrite</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://influxdb-prod.&lt;domain>/api/v1/prom/write?db=prodPrometheus\"</span>\r\n  <span class=\"token key atrule\">remoteRead</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://influxdb-prod.&lt;domain>/api/v1/prom/read?db=prodPrometheus\"</span></code></pre></div>\n<h3>Prometheus Agent configuration</h3>\n<p>Note that I have found since we use defaultFlagsOverride to set this, we will need to put in additional arguments since you are overriding the default arguments that the Prometheus containers start up with.</p>\n<ul>\n<li>The <a href=\"https://prometheus.io/docs/prometheus/latest/feature_flags/#prometheus-agent\">enable-feature=agent</a> puts the Prometheus-server into agent mode</li>\n<li>The config.file is where the prometheus.yaml file is located</li>\n<li>The <a href=\"https://prometheus.io/docs/prometheus/latest/migration/#prometheus-lifecycle\">web.enable-lifecycle</a> allows HTTP Post request to be sent to the /-/reload endpoint so that it will reload any configmap/config when it is updated</li>\n<li>The remoteWrite is set to the Prometheus Server endpoint so that it can write data to that server</li>\n<li>The external_labels is used to add labels to the metric data that the Prometheus agent sends to the Prometheus server. Note that if you alreaedy have metrics any old data already written to storage will not have any external_labels appended to it, only new data.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">global</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">external_labels</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">clustername</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Test01\"</span>\r\n      <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Test\"</span>\r\n  <span class=\"token key atrule\">defaultFlagsOverride</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>enable<span class=\"token punctuation\">-</span>feature=agent\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>config.file=/etc/config/prometheus.yaml\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>web.enable<span class=\"token punctuation\">-</span>lifecycle\r\n  <span class=\"token key atrule\">remoteWrite</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://prometheus-server.&lt;domain>/api/v1/write\"</span></code></pre></div>\n<h2>Conclusion</h2>\n<p>In my opinion utilising the Prometheus agent is the simplests way to monitor multiple clusters and send the data to a centralised server for use to query. The information in this blog should help point you in the right direction to set this up or at least let you think on how to implement this. A more detailed blog regarding Prometheus agent in general can be found <a href=\"https://prometheus.io/blog/2021/11/16/agent/\">here</a>.</p>","categories":["Monitoring","Kubernetes","AKS"],"date":"October 01, 2023","description":"Monitoring multiple clusters","id":"86fafd76-43f6-530e-a32e-a0c572c845ad","keywords":["Monitoring","Prometheus","Kubernetes","AKS","Multi-region","Multi-cluster","Blog"],"slug":"/PrometheusMultiClusterMonitoring/","title":"Prometheus Multi-clustered Monitoring","readingTime":{"text":"4 min read"}},{"banner":{"alt":"Python Background","caption":"Photo by <u><a href=\"https://unsplash.com/photos/ieic5Tq8YMk\">Chris Ried</a></u>","src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#181818","images":{"fallback":{"src":"/static/7e50a32e75c8161805264077d188cdd2/91671/chris-ried-ieic5Tq8YMk-unsplash.jpg","srcSet":"/static/7e50a32e75c8161805264077d188cdd2/7e3b4/chris-ried-ieic5Tq8YMk-unsplash.jpg 165w,\n/static/7e50a32e75c8161805264077d188cdd2/47f88/chris-ried-ieic5Tq8YMk-unsplash.jpg 330w,\n/static/7e50a32e75c8161805264077d188cdd2/91671/chris-ried-ieic5Tq8YMk-unsplash.jpg 660w,\n/static/7e50a32e75c8161805264077d188cdd2/5aaff/chris-ried-ieic5Tq8YMk-unsplash.jpg 1320w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/7e50a32e75c8161805264077d188cdd2/322ad/chris-ried-ieic5Tq8YMk-unsplash.webp 165w,\n/static/7e50a32e75c8161805264077d188cdd2/de3b3/chris-ried-ieic5Tq8YMk-unsplash.webp 330w,\n/static/7e50a32e75c8161805264077d188cdd2/2b2b5/chris-ried-ieic5Tq8YMk-unsplash.webp 660w,\n/static/7e50a32e75c8161805264077d188cdd2/e36a7/chris-ried-ieic5Tq8YMk-unsplash.webp 1320w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":400}}}},"body":"<p>Having scripted mostly in Powershell &#x26; Bash the majority of my DevOps career (all of 3 years). I thought I would dabble in some Python scripting one evening. I have some Python experience having learned some basics during my Masters degree, I thought I might as well use this opportunity to refresh myself in the language loved by many Software Developers and DevOps Engineers alike.</p>\n<h2>Choosing the Module</h2>\n<p>The module I chose to experiment with this evening was one that I read about online called \"<a href=\"https://www.fabfile.org/\">Fabric</a>\". It is described as a \"... high level Pyton library designed to execute shell commands remotely over SSH, yielding Python objects in return\". I chose this module to play around with this evening as I myself find it a hassle sometimes to run commands on linux VMs. Utlising this module we can do the following by just running the script locally:</p>\n<ul>\n<li>Run commands on individual or multiple hosts at a time</li>\n<li>Automate commands that are used frequently either to solve issues or we can write Python script functions to</li>\n</ul>\n<h2>Setting up the local environment</h2>\n<p>To play with the Fabric module I created a local Docker image to run locally on my PC.\r\nDockerFile based on the one <a href=\"https://dev.to/s1ntaxe770r/how-to-setup-ssh-within-a-docker-container-i5i\">here</a></p>\n<p>(Yes I know the password is super secure!👀)</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> ubuntu:latest</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt update &amp;&amp; apt install  openssh-server sudo -y</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> useradd -rm -d /home/ubuntu -s /bin/bash -g root -G sudo -u 1000 pythonScriptUser</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span>  echo <span class=\"token string\">'pythonScriptUser:test123'</span> | chpasswd</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> service ssh start</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 22</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [<span class=\"token string\">\"/usr/sbin/sshd\"</span>,<span class=\"token string\">\"-D\"</span>]</span></code></pre></div>\n<p>As well as this of course I had to have Python as well as pip install the fabric module</p>\n<h2>Creating the script</h2>\n<p>I decided to just create functions for different operations for easier reusability. Though obviously the script can be improved if it were to actually be used in a working environment (remember this was just for me to mess around with!).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> fabric <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\r\n\r\n<span class=\"token comment\">#Initiate the connection to the host</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">ssh_connection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    config <span class=\"token operator\">=</span> Config<span class=\"token punctuation\">(</span>overrides<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'pythonScriptUser'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'connect_kwargs'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'test123'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sudo'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'test123'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    conn <span class=\"token operator\">=</span> Connection<span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> user<span class=\"token operator\">=</span><span class=\"token string\">\"pythonScriptUser\"</span><span class=\"token punctuation\">,</span> config<span class=\"token operator\">=</span>config<span class=\"token punctuation\">,</span> port<span class=\"token operator\">=</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">return</span> conn\r\n\r\n<span class=\"token comment\">#run the uptime command</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">uptime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    ssh_connection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token string\">'uptime'</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\">#Install the array of packages given to the function</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">installPackages</span><span class=\"token punctuation\">(</span>packages<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>    \r\n    <span class=\"token keyword\">for</span> package <span class=\"token keyword\">in</span> packages<span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"installing \"</span><span class=\"token operator\">+</span>package<span class=\"token punctuation\">)</span>\r\n        ssh_connection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sudo<span class=\"token punctuation\">(</span><span class=\"token string\">\"apt install \"</span><span class=\"token operator\">+</span> package <span class=\"token operator\">+</span><span class=\"token string\">\" -y\"</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\">#run the nslookup command</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">nslookup</span><span class=\"token punctuation\">(</span>hostname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    ssh_connection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token string\">\"nslookup \"</span><span class=\"token operator\">+</span>hostname<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\">#upload a file to the host given the source of the file and the destination</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">uploadFile</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"uploading \"</span><span class=\"token operator\">+</span> source <span class=\"token operator\">+</span><span class=\"token string\">\" to \"</span><span class=\"token operator\">+</span> destination<span class=\"token punctuation\">)</span>\r\n    ssh_connection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>put<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span> destination<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\">#download file from the source to the destination</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">downloadFile</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"downloading \"</span><span class=\"token operator\">+</span> source <span class=\"token operator\">+</span><span class=\"token string\">\" from \"</span><span class=\"token operator\">+</span> destination<span class=\"token punctuation\">)</span>\r\n    ssh_connection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span>destination<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\"># below we are just running the functions that were created above</span>\r\npackages <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"vim\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"neofetch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"net-tools\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"dnsutils\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"curl\"</span><span class=\"token punctuation\">]</span>\r\ninstallPackages<span class=\"token punctuation\">(</span>packages<span class=\"token punctuation\">)</span>\r\n\r\nnslookup<span class=\"token punctuation\">(</span><span class=\"token string\">\"www.google.com\"</span><span class=\"token punctuation\">)</span>\r\n\r\nuploadFile<span class=\"token punctuation\">(</span><span class=\"token string\">\"C:\\\\temp\\\\transfer-test.txt\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/home/ubuntu\"</span><span class=\"token punctuation\">)</span>\r\n\r\ndownloadFile<span class=\"token punctuation\">(</span><span class=\"token string\">\"/etc/adduser.conf\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"C:\\\\temp\\\\test.txt\"</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\">#cd with context manager. As just doing ssh_connection().run(\"cd /var\") wouldn't work</span>\r\n<span class=\"token keyword\">with</span> ssh_connection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>cd<span class=\"token punctuation\">(</span><span class=\"token string\">\"/var\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    ssh_connection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token string\">\"pwd\"</span><span class=\"token punctuation\">)</span>\r\n</code></pre></div>\n<h2>Overall</h2>\n<p>I believe from this small demonstration and having played around with it (for all of 1 hour) that in future if possible, I will try utilise Python when given the opportunity. Python can be used in DevOps lifecycle for such things as automation, configuration management and provisoning. The fact also that it can be ran on the linux and windows OS is also an additional benefit. I personally have had issues when trying to create cronjobs using powershell running on a linux OS due to the size of the image and workarounds I had to implement. But using Python we can potentially overcome these issues.</p>\n<p>From my point of view the benefits of this are:</p>\n<ul>\n<li>Easily readable code - Python is known to be \"user-friendly\" as the the syntax is very readable and as a result the code itself is \"documentation\". If the actual documentation is missing (Though it shouldn't be the case, right?😉). It also allows for better efficency and production due to this simple syntax, which most people can pick up quickly or at least have an understanding of what the script is doing</li>\n<li>Vast amount of available modules/libraries - If there is something you want to script with Python it most likely already been done or the foundations are already out there</li>\n<li>Huge community - Means modules and scripts are probably already existing out there</li>\n</ul>","categories":["Scripting","Monitoring","Python"],"date":"August 26, 2023","description":"Python Scripting with Fabric library","id":"f5c13ce9-4e0d-56cc-92d4-f66293896cfa","keywords":["Scripting","Monitoring","Python","Blog","Fabric"],"slug":"/PythonScriptingFabricLibrary/","title":"Python Scripting with Fabric library","readingTime":{"text":"4 min read"}},{"banner":{"alt":"FluentBit Background","caption":"Photo by <u><a href=\"https://unsplash.com/photos/oQD9uq4Rd4I\">Michał Jakubowski</a></u>","src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#4898b8","images":{"fallback":{"src":"/static/355967cea4704166703b831eff82c587/91671/michal-jakubowski-oQD9uq4Rd4I-unsplash.jpg","srcSet":"/static/355967cea4704166703b831eff82c587/7e3b4/michal-jakubowski-oQD9uq4Rd4I-unsplash.jpg 165w,\n/static/355967cea4704166703b831eff82c587/47f88/michal-jakubowski-oQD9uq4Rd4I-unsplash.jpg 330w,\n/static/355967cea4704166703b831eff82c587/91671/michal-jakubowski-oQD9uq4Rd4I-unsplash.jpg 660w,\n/static/355967cea4704166703b831eff82c587/5aaff/michal-jakubowski-oQD9uq4Rd4I-unsplash.jpg 1320w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/355967cea4704166703b831eff82c587/322ad/michal-jakubowski-oQD9uq4Rd4I-unsplash.webp 165w,\n/static/355967cea4704166703b831eff82c587/de3b3/michal-jakubowski-oQD9uq4Rd4I-unsplash.webp 330w,\n/static/355967cea4704166703b831eff82c587/2b2b5/michal-jakubowski-oQD9uq4Rd4I-unsplash.webp 660w,\n/static/355967cea4704166703b831eff82c587/e36a7/michal-jakubowski-oQD9uq4Rd4I-unsplash.webp 1320w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":400}}}},"body":"<h1>🚧To be Written!🚧</h1>\n<!-- ## Code block test\r\n\r\n```css\r\n.AClass .Subtitle {\r\n  margin: -0.5rem 0 0 0;\r\n  font-weight: 700;\r\n  font-size: 1.25rem;\r\n  line-height: 1.5rem;\r\n}\r\n\r\n.AnotherClass p {\r\n  font-size: 1.125rem;\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.AThirdClass {\r\n  display: flex;\r\n  justify-content: flex-start;\r\n  align-items: center;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .AClass {\r\n    flex-direction: column;\r\n  }\r\n  .AnotherClass {\r\n    display: block;\r\n  }\r\n}\r\n```\r\n\r\nInline code: `print()`\r\n\r\nLorem ipsum dolor sit amed Vel ut spiritday all cultural Lili Elbe lorem in sexuality Herstory sit lorem Ac Genderless homoflexible trans Carrie Fisher Transgender love family cross-dresser ac a ut Ac xe she ut Tina Anselmi woman Marina Abramovich Lesbians and Gays Support the Miners Ipsum Chimamanda Ngozi sed sit Equal movement gender ut est lorem Laura Jane Grace Emma Watson sem eu.\r\n\r\n**Maria Montessori vel sem in eu Leelah Alcorn** In eu Leelah Alcorn in Margaret Sanger future Martha Nussbaum eu gender non-conformity Family cross-dresser ac a ut representation drag queen Ac third wave Hannah Gadsby culture feminismus ac suffragette cisgender in a eu Ac a ut representation drag queen Out Lorem ac no means no f word sed Emmeline Pankhurst.\r\n\r\n## Second Headline\r\n\r\nEst vel est appreciation Nadia Murad Basee Taha cross-dressing vel Ut mi sit ut eu id Samira Wiley sit vel sem Ut romance in gender studies ballroom Sit lorem ac no means no f word sed Emmeline Pankhurst Ac sorellanza In Lea Delaria in grrlpwr pansexual intersectional yas queen diritti id mi Sem Audre Lorde Sappho in sed et empowerment genderqueer intersex.\r\n\r\n![This is the alt tag.](../../images/kelly-sikkema-Hl3LUdyKRic-unsplash.jpg \"This is a markdown [caption](https://konstantin.digital).\")\r\n\r\nFeminizmas eu Dian Fossey ac third wave notion supporting androgyny dui ut People a Sylvia Plath mi sex-positivity demisexual a equality suffragettes pronouns Vel est appreciation Nadia Murad Basee Taha cross-dressing vel Sustainability ut sit dui Lesbians and Gays Support the Miners local eu Hanna Gaby Odiele est queer Misty Copeland She ut Tina Anselmi woman Marina Abramovich Lesbians and Gays Support the Miners local Equal ac et ut romance in Second wave sit friendship grl pwr castro.\r\n\r\n### Third Headline\r\n\r\nVel sem Sed Roxane Gay Caitlin Moran Ace id Amelia Earhart Gloria Steinem Samira Wiley sit Amelia Earhart Gloria Steinem eu In et ac in Alexandria Ocasio-Cortez Emmy Noether a Bi-visibility Dance Simone de Beauvoir eu sem.\r\n\r\n#### Fourth Headline\r\n\r\nAlexandria Ocasio-Cortez Emmy Noether a Bi-visibility dui et voices Stonewall Inn sem et Ac pride month lorem et eu dui sit eu ut Eu ut Et in lorem id sed Id Kate Bornstein smash the patriarchy et et eu motivational ut In Chimamanda Ngozi sed sit strength.\r\n\r\n![This is the alt tag.](../../images/charles-deluvio-DgoyKNgPiFQ-unsplash.jpg)\r\n\r\nVel herstory Bossy sit ac xe she ut Tina Anselmi woman Marina Abramovich Spiritday all cultural Lili Elbe lorem in sexuality Transformation lgbt freedom et ac sem Sem we are everywhere Notion supporting androgyny dui ut dance Simone de Beauvoir eu sem sit Inge Schonöethal Feltrinelli female gaze ac Franca viola. -->","categories":["Monitoring","Kubernetes","AKS"],"date":"March 12, 2023","description":"The Wonders of FluentBit","id":"bfc8e71b-7270-57f8-9445-6c15212d51fc","keywords":["Monitoring","FluentBit","Kubernetes","AKS","Blog"],"slug":"/FluentBit/","title":"The Wonders of FluentBit","readingTime":{"text":"3 min read"}},{"banner":{"alt":"IaC","caption":"Photo by <u><a href=\"https://unsplash.com/photos/zwd435-ewb4\">Andrea De Santis</a></u>","src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#283838","images":{"fallback":{"src":"/static/9e2389dadc3934d1e0ba6f52d023d46e/91671/andrea-de-santis-zwd435-ewb4-unsplash.jpg","srcSet":"/static/9e2389dadc3934d1e0ba6f52d023d46e/7e3b4/andrea-de-santis-zwd435-ewb4-unsplash.jpg 165w,\n/static/9e2389dadc3934d1e0ba6f52d023d46e/47f88/andrea-de-santis-zwd435-ewb4-unsplash.jpg 330w,\n/static/9e2389dadc3934d1e0ba6f52d023d46e/91671/andrea-de-santis-zwd435-ewb4-unsplash.jpg 660w,\n/static/9e2389dadc3934d1e0ba6f52d023d46e/5aaff/andrea-de-santis-zwd435-ewb4-unsplash.jpg 1320w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/9e2389dadc3934d1e0ba6f52d023d46e/322ad/andrea-de-santis-zwd435-ewb4-unsplash.webp 165w,\n/static/9e2389dadc3934d1e0ba6f52d023d46e/de3b3/andrea-de-santis-zwd435-ewb4-unsplash.webp 330w,\n/static/9e2389dadc3934d1e0ba6f52d023d46e/2b2b5/andrea-de-santis-zwd435-ewb4-unsplash.webp 660w,\n/static/9e2389dadc3934d1e0ba6f52d023d46e/e36a7/andrea-de-santis-zwd435-ewb4-unsplash.webp 1320w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":400}}}},"body":"<h2>Introduction</h2>\n<p>With more and more businesses utilising Cloud platforms such as Azure, AWS or GCP and deploying their infrastructure to the cloud, it has become important to find ways to automate the deployment process of this. The benefits of automating deployment of IaC and IaC itself are:</p>\n<ul>\n<li><strong>Diaster recovery</strong> - Having your infrastructure all coded out and automated allows you to redeploy your infrastructure in a few minutes. It also allows you to rollback changes to a working state if any new changes break your infrastructure.</li>\n<li><strong>Auditing</strong> - Utilising IaC you can use branching policies and pull requests in your code repo to review any changes that are going to be made to the infrastructure (more on this later). Meaning you have an audit trail of the changes that have been made.</li>\n<li><strong>Security</strong> - You can increase security by reducing permissions that people have in the Cloud Portal so that no deployments can be done via the portal and only via IaC.</li>\n<li><strong>Productivity/Efficiency</strong> - By having your infrastructure as code you can deploy multiple environments e.g. for development, QA, production. This would take minutes, rather than hours when trying to deploy it via the portal. Saving time for engineers to spend time doing other tasks.</li>\n<li><strong>Documentation</strong> - The IaC is your documentation for your infrastructure so if an engineer leaves, the infrastructure that is required is already documented and procedures to deploy and change it should be in place.</li>\n</ul>\n<p>This blog will inform you how to deploy your Terraform scripts using Azure DevOps pipelines. Bearing in mind I have wrote this thinking you know about Terraform and have some understanding of Azure DevOps</p>\n<h2>How to Automate deploying Infrastructure</h2>\n<p>By using the tool Terraform and CI/CD pipelines provided by Azure DevOps, we can build, change and version infrastructure both safely and efficiently. The first job is the map out your infrastructure and convert it into code by using Terraform. Terraform provides very good documentation on how to map out your resources into Terraform scripts, which can be found here. If you use certain cloud platforms here are some Terraform documentation below:</p>\n<ul>\n<li><a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs\">Azure</a></li>\n<li><a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs\">AWS</a></li>\n<li><a href=\"https://registry.terraform.io/providers/hashicorp/google/latest/docs\">Google Cloud Platform</a></li>\n</ul>\n<p>Once you have your infrastructure beautifully coded into Terraform you can start configuring your pipelines. In Azure DevOps you should set up your pipelines</p>\n<h2>Build Pipeline</h2>\n<p>The reason why we have a build pipeline is are for a number of reasons:</p>\n<ol>\n<li>To check your code is valid before you can commit it to the master branch e.g. very useful once branch policies are set up for Pull requests</li>\n<li>So that you can check the what changes will be made to the infrastructure if you deploy the Terraform scripts. As you can see from the example below one of the build steps is a \"Terraform Plan\" step which will show us the changes that will be made to the infrastructre, here it will create an Azure Kubernetes cluster. Terraform Plan is nicely formatted at the build pipeline with symbols with \"+ = create\", \"- = destroy\" and \"~ = changes\".</li>\n</ol>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.84848484848484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB70lEQVR42n2S/W6bMBTF+xyNbQwEsK8/sQ02EGhC2mSqqr3/40xk0zRpDdKV7H9+PsfnnpemrjhreFNz1gDfRgIIYKyugDPB2bHIM4JpRv6fl9iHeRqnFDvv+uBPY4pd6DvfeX8ahtMYndUEo+/hqiqt0XVVFjktivxY5EVO85yWvy80y2n2LbnBErhWQgEYJbUSEsBqpZW0WuU0e2b4D8x5s8xT8O2Q4jaxG1PczAffBx9864yxWksprNEC+L/PvdA8c86OQ0yxN0Zbo7SUrrW996kLv/WfKmN00FZ9/bgPsTdaeWetVs61t3V9m0/n86IFYIzyb2GCMQAD3qDDa04zghFGByVFDCF4l1KvBMfP0sYIWWc+77f7+/V9vXTeZwS7tr2/b8rX9ayAPV0VwUhIPg1pHJIAVh1LmhEAHrsQXBu70FTHpyUhm7L++fV5u17Py8zqCh1evWtv13UahmU+Sd7sKGMObEyxfmgWOSUYAfB5HE7T2NR1Qele2rbVH+sl9X0X3BYPOlhjPi7ny7Kslzcl+J4yCHZ5m8/LnPpOAWzLU3KZxtQFoxSrd/78sO1bU+aUNXV1LDOCgfMYgm+tMWovsIzguqlarZUU1bFEh1eCEcEoIzgjeKdej3o+DgBmH90UnEsBEtgO8xf+BX+VnQOyZOz2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7a293f0fb1569183ff054586317cd11b/c9b55/Terraform-Plan-Example.webp 165w,\n/static/7a293f0fb1569183ff054586317cd11b/f2908/Terraform-Plan-Example.webp 330w,\n/static/7a293f0fb1569183ff054586317cd11b/c12c1/Terraform-Plan-Example.webp 588w\"\n              sizes=\"(max-width: 588px) 100vw, 588px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7a293f0fb1569183ff054586317cd11b/04c57/Terraform-Plan-Example.png 165w,\n/static/7a293f0fb1569183ff054586317cd11b/d9ecf/Terraform-Plan-Example.png 330w,\n/static/7a293f0fb1569183ff054586317cd11b/9bbaf/Terraform-Plan-Example.png 588w\"\n            sizes=\"(max-width: 588px) 100vw, 588px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7a293f0fb1569183ff054586317cd11b/9bbaf/Terraform-Plan-Example.png\"\n            alt=\"Terraform Plan\"\n            title=\"Example of Terraform Plan\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Example of Terraform Plan</p></figcaption>\n  </figure>\r\nThe following steps should be added to your Build Pipelines\r\nNote:</p>\n<ul>\n<li>This uses the Azure DevOps Terraform Plugin which can be found <a href=\"https://marketplace.visualstudio.com/items?itemName=charleszipp.azure-pipelines-tasks-terraform\">here</a></li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 573px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.45454545454545%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABdElEQVR42pXOzU7bQBiFYd8EAikQz489Y3vms+M4k7FDqLEJhbTlJwGFSCBQACURiUBFIFh03yto1UVZoKhbrhFRdR1T6dm+OsfQ7dO0O9afB1ZygOodEndp3CVFWHoSrO0Yq52rxuFXtTulH84aexPRumDZgOfn82QDb2scZD0jOfqxPnzee5h1Hv+Mvr/s3s82pk/J5a859PnP6vB3evzNqLRGaucm7d3m/Tu9fx20x5X22N8ezQFbQ//TJMx7BrfqLvNjFdbCwLHJ8tKCubxUrLSIyiXDpoHDIUl0tVIBACkEMsvINAsRjA1uac+rNpuJiiIACABQeeVvX4BgZHAr4EyA9KTwPNcxV95V/osJrjEWpGkz1jFIQTD6j3jU+dJvf4xUra5UFIZRNdRa+SDNovNv8fZqktYVgHQdThCiFNsWtQh+1zLCyBXeZivfyLM8y2KtG0msahEleP74W+w5XLgOSOFLCVIy27ItymzKmV3oFS9HlyeCYURtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e8f6844011c0151d9b878cc627f051af/c9b55/BuildPipeline.webp 165w,\n/static/e8f6844011c0151d9b878cc627f051af/f2908/BuildPipeline.webp 330w,\n/static/e8f6844011c0151d9b878cc627f051af/351b3/BuildPipeline.webp 573w\"\n              sizes=\"(max-width: 573px) 100vw, 573px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e8f6844011c0151d9b878cc627f051af/04c57/BuildPipeline.png 165w,\n/static/e8f6844011c0151d9b878cc627f051af/d9ecf/BuildPipeline.png 330w,\n/static/e8f6844011c0151d9b878cc627f051af/3c024/BuildPipeline.png 573w\"\n            sizes=\"(max-width: 573px) 100vw, 573px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e8f6844011c0151d9b878cc627f051af/3c024/BuildPipeline.png\"\n            alt=\"Build Pipeline Tasks\"\n            title=\"Example of Build Pipeline tasks\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Example of Build Pipeline tasks</p></figcaption>\n  </figure></p>\n<ul>\n<li><strong>Terraform Install</strong> - This step installs Terraform and the version which you dictate onto the build agent</li>\n<li><strong>Terraform Init</strong> - This step initialises Terraform on the build agent and also creates a .tfstate file that will house the state of the infrastructure e.g. what is deployed. You can choose where to create this .tfstate file, I recommend storing it in a storage account within the Azure Subscription you are deploying too.</li>\n<li><strong>Terraform Validate</strong> - This step validates that the syntax of your code is correct</li>\n<li><strong>Terraform Plan</strong> - This steps will compare the code in your Terraform files to the infrastructure that is deployed (dictated in the .tfstate file more info here) and output the changes it will do. It is also here you add in the variables you are injecting into the Terraform scripts, make sure to utilise the Azure DevOps Library Sets.</li>\n<li><strong>Delete files from Terraform</strong> - This is just used to delete any Terraform modules in your ./Terraform folder. This step is Optional</li>\n<li><strong>Publish Artifact</strong> - This basically will create an artifact that contains your Terraform files in your repository, which will be then used in the release pipeline</li>\n</ul>\n<h2>Release Pipeline</h2>\n<p>The release pipeline has two stages <strong>Terraform Plan Stage</strong> and <strong>Terraform Apply Stage</strong> both have the same steps, but the <strong>Terraform Apply Stage</strong> has the additional step which will tell Terraform to apply the plan to the infrastructure. The reason why it is set up like this are:</p>\n<ul>\n<li>To check that your code is valid. Although we did this at the build step it's always good to double check</li>\n<li>You can add a pre-approval gate before Terraform deploys the infrastructure changes. This is a good gate to have to ensure that the appropriate people can approve deployment changes, this adds security and responsibility as well as auditing</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.54545454545455%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+0lEQVR42o2POU7EQBBFfQ+7u7Ze7HZ5GYOHkUeaYDQkJIgIaVIiMgJuwDm4BQdEXiCF0ou+9PR/Zd654D2LMBETBu+E5yOEP8k0VW2K4jyLE6Zhtwux9LEksASGwCDYFdowuISzHFObxnM9TFpFJ2KKHAAKIANkyQHLalokA2xwCZHQmlk+Pb5cP75Or5/j/TNDIUxt3+vNodsfpVJfaQhemLphbG6nbj/5uiuTMgICZN3hcrm+3z29tccHtDkipCpqo03bB8dxFpEQmjo1baeqQSh6t812jFqXWkc0ORMiWLBmofj99icswBqcO+0mC3OdqjIGQlhL/s83MVE+Ihibyj8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ffdd03550e64c30d0e68c519e23d86ab/c9b55/ReleasePipeline.webp 165w,\n/static/ffdd03550e64c30d0e68c519e23d86ab/f2908/ReleasePipeline.webp 330w,\n/static/ffdd03550e64c30d0e68c519e23d86ab/cc661/ReleasePipeline.webp 660w,\n/static/ffdd03550e64c30d0e68c519e23d86ab/e299d/ReleasePipeline.webp 866w\"\n              sizes=\"(max-width: 660px) 100vw, 660px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ffdd03550e64c30d0e68c519e23d86ab/04c57/ReleasePipeline.png 165w,\n/static/ffdd03550e64c30d0e68c519e23d86ab/d9ecf/ReleasePipeline.png 330w,\n/static/ffdd03550e64c30d0e68c519e23d86ab/1f083/ReleasePipeline.png 660w,\n/static/ffdd03550e64c30d0e68c519e23d86ab/c1328/ReleasePipeline.png 866w\"\n            sizes=\"(max-width: 660px) 100vw, 660px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ffdd03550e64c30d0e68c519e23d86ab/1f083/ReleasePipeline.png\"\n            alt=\"Release Pipeline\"\n            title=\"Example of Release Pipeline\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Example of Release Pipeline</p></figcaption>\n  </figure></p>\n<h3>Terraform Plan Stage</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 565px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.42424242424243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABOElEQVR42pXOS0vDQBSG4fkhzVwztzSTZCaTSS9pqVqkm+JGqy5EqKC4E9daoYtW/dVSrdsa4eGFs/jggMIYbwulZF0FSlAobSgLLXnTr7tK2Nx4myse195RDFHUwXCPoAiMbtand9vpcju+3biLV/+t3HX1099z173zl+pqXcyfwOzhc/74Mbt/ny43frGqLt/+tljV12t39gxckZVFnihOUMQI3MGQ4ugwRikjCDTN4OR4UtcBYwhhhBBECBKCD2OxJAQDyS3naZ6lzlpn8ywzJtWUoMMIhpQgIOIy0bbfD81w2KuDklJJgRFsA0gelLS92le+NGmCog6MOm3HnGWCp87lmTE8ZgTvXmo71mLQ1eFoMh41TeU9oxjB9mPZ1SrJszRNEhEzweP2gFZCK6EEV1JoJf/lC0C2gNsKt9ZVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fb4ab51541b2af64806501983855eb62/c9b55/ReleasePipelinePlan.webp 165w,\n/static/fb4ab51541b2af64806501983855eb62/f2908/ReleasePipelinePlan.webp 330w,\n/static/fb4ab51541b2af64806501983855eb62/acb73/ReleasePipelinePlan.webp 565w\"\n              sizes=\"(max-width: 565px) 100vw, 565px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fb4ab51541b2af64806501983855eb62/04c57/ReleasePipelinePlan.png 165w,\n/static/fb4ab51541b2af64806501983855eb62/d9ecf/ReleasePipelinePlan.png 330w,\n/static/fb4ab51541b2af64806501983855eb62/07eba/ReleasePipelinePlan.png 565w\"\n            sizes=\"(max-width: 565px) 100vw, 565px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fb4ab51541b2af64806501983855eb62/07eba/ReleasePipelinePlan.png\"\n            alt=\"Release Pipeline Plan Tasks\"\n            title=\"Example of Release Pipeline Plan Tasks\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Example of Release Pipeline Plan Tasks</p></figcaption>\n  </figure></p>\n<h3>Terraform Apply Stage</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 570px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.878787878787875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAuUlEQVR42pWPWRKCMBBEcw6V7MlkRkAgkALLAC73P5OlJwhV77f7dbN93/PjDt45Y6TgRUihLUjBWZr6GHvv7eV80koWYozRSjJvHynFnPPn/ZriMMYBvOPVpWQCsxqJQn2lW9vYX51QUhTuZwTbMqd928Y4OGdEVZU+F5xpBfWV2qYJ4P9ifiBM8Fzmac1rSgkRjpmNwrap++5WEyKGg+bw+pnXdYxx6DvBj5gDWKJAiOCddxYDlPMFY4lTrfxg2XwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/21ca9fff7388087fda6be8398dbea7fc/c9b55/ReleasePipelineApply.webp 165w,\n/static/21ca9fff7388087fda6be8398dbea7fc/f2908/ReleasePipelineApply.webp 330w,\n/static/21ca9fff7388087fda6be8398dbea7fc/048c8/ReleasePipelineApply.webp 570w\"\n              sizes=\"(max-width: 570px) 100vw, 570px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/21ca9fff7388087fda6be8398dbea7fc/04c57/ReleasePipelineApply.png 165w,\n/static/21ca9fff7388087fda6be8398dbea7fc/d9ecf/ReleasePipelineApply.png 330w,\n/static/21ca9fff7388087fda6be8398dbea7fc/432e7/ReleasePipelineApply.png 570w\"\n            sizes=\"(max-width: 570px) 100vw, 570px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/21ca9fff7388087fda6be8398dbea7fc/432e7/ReleasePipelineApply.png\"\n            alt=\"Release Pipeline Apply Tasks\"\n            title=\"Example of Release Pipeline Apply Tasks\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Example of Release Pipeline Apply Tasks</p></figcaption>\n  </figure></p>\n<p>As you can see these are similar steps to those used in the Build Pipeline with the new step called <strong>Terraform Apply</strong> which will deploy the changes that it dectects from the .tfstate file and your Terraform files.</p>\n<h2>Making Changes to Infrastructure</h2>\n<p>It is here I recommend adding branching policies which will enforce people to use Pull requests before merging into the branch you are using in your build pipeline e.g. \"Master\" branch. Setting it up like this allows for the build pipeline to run and pass before it is even allowed to be approved to be merged into the Master branch. Below is a Branching policy I added to the Master branch, which requires that pull requests is approved by 2 approvers, but also passes the Build pipeline we set up earlier. By doing this you can see the code works, more importantly you see the <strong>Terraform Plan</strong> and what changes would be deployed which is helpful to see for the approvers. You can see below the branch policy and the build validation being set for the Master Branch</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 118.7878787878788%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC2ElEQVR42qVV2XLiQAzkU3ZzEMJhMGBjz/i+EjDhXP7/U3qrZYYrsFWpfeiasa3RSOqW3Jq5DvIsRfvlGU+/f+Hl+em/0BpaFpTvwR4NMbQG6L530Ou+y/pT8FxrNLSwXtb4IuoaQaChlY8wDBBojUArQag14jhCFAYC2oWBPu2jKITrTNHqDwaYehquO4Xnuo2BVmLA/emQVmB5vJkL5c3gETMX/nHPLJ3pGK2ONcFTfBBj3rDf7bBerbBcLrES1NisV/iqFwi0L06YFUvE9RJ81+r3upiMbdhDC9PJGGVRSDS82YDf+Y0Xch3bo4c4OxwNZVXKk2jpaOZOZc+Cd97a6HU7Ynfp4Pb5yiFfmAgmNBg1Rs50Iu/pnCvVYNI0Ts35bxFmaSKM1/M5Pj8q1Is55p8f+KhK1PUCeZoIAVQBs/hnhFzJblXmqKoCRZ6hyFMUWYaqKFAWOaqyEPAC1vSuQ8MYHcZR1BysGgdlnsnhj7JEnmUSdZrEkvptysIy60Ep0IBgOlp5Im7DNi8yMPU0zr6xTCNKhQddx8Hh8Af77Qa77Ra7zRr1fIFANeIOQw2lfIlEa3VF5lXK3JiUGRmfrUFfYN6bDLg3ajD7K4f8wCIzQqazmH9i/llhtVxg9VXja7WE8v2m7ajPmSt2t5GdHLKGxhmdp0ki0smSGGGgpPFZV9M12veE3Yed0tQwF2JouNtscDjssd9tRXMyeYLjhFFK9OfNnMcRGh1Kd0zGMl3MhEmiENNj5M7Feo+Mk8O39qv0Kdf268sJ5pnfLvHeeTuic7E/QyKMo1DEyxZL40jSN8yK/uyzDi9FfA8tjm3f96WOWRojTSIhht2QxLGQk8SRXJrGsTh9JOqG5UEPRRI0LWSPpDvG8n+x7o4qMs3LblvuHKFloxuv4DjNxN6u11jWcxkQJKAZZWcBXxJzn5RuH0+TBLZtS2dQczTmftDvgTX+Cf4C+WUHh83w2NEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/62240c16d53fcfd3bdfc15dfd21995eb/c9b55/BranchPolicies.webp 165w,\n/static/62240c16d53fcfd3bdfc15dfd21995eb/f2908/BranchPolicies.webp 330w,\n/static/62240c16d53fcfd3bdfc15dfd21995eb/cc661/BranchPolicies.webp 660w,\n/static/62240c16d53fcfd3bdfc15dfd21995eb/f686e/BranchPolicies.webp 692w\"\n              sizes=\"(max-width: 660px) 100vw, 660px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/62240c16d53fcfd3bdfc15dfd21995eb/04c57/BranchPolicies.png 165w,\n/static/62240c16d53fcfd3bdfc15dfd21995eb/d9ecf/BranchPolicies.png 330w,\n/static/62240c16d53fcfd3bdfc15dfd21995eb/1f083/BranchPolicies.png 660w,\n/static/62240c16d53fcfd3bdfc15dfd21995eb/91e7e/BranchPolicies.png 692w\"\n            sizes=\"(max-width: 660px) 100vw, 660px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/62240c16d53fcfd3bdfc15dfd21995eb/1f083/BranchPolicies.png\"\n            alt=\"Branch Policy Example\"\n            title=\"Example of branch policy with build validation\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Example of branch policy with build validation</p></figcaption>\n  </figure></p>\n<p>Make sure that if you do this, that your release pipeline is set to build off artifacts made by the Master branch only. Otherwise if it triggers on the latest build the build that is produced by the pull request will be used.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 586px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 106.06060606060606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACSklEQVR42pWSW1LUQBSGexMq6iR979z6ksuEmaLUR2QB6h7UTeAuIAnlCMMzuAGSQXzGhZDIlGF8HCsD+oIww6mvuvpUn9Pn7+ofUIIZJRjZBEOC0TIgRh0EQ8Y48Fx3a3MzCjWCEEH7Xizqhmm/LwMPL4oBIUx42lOJp2JPxRhjBK07+7uZCKObMYASLH2PIOhwhqANbWt1AGdsuN43SmqlGCWrQzACcRRJ6adJLAOfEiwE54wKzpbCKAGMEhn4KvBDrYxWBNqeI2yrt5RONqNksJ5uDAcbw8FwkEbGSN9bdTJCUAZ+aJTW0hgVhUZwxhldCiUYcEZj0wl2BaMYU0J6z59dq7r/2zvZBKMoNGk/iYxJ4jiJoyg0SRS6Dl846T8+wwgySjij3ZvTJE7i0GitZKBkoGXQCXE4gva1GW/T3YIgYFz004E2EUSkZ8MehN1qQxthiMldIMIQYQAR6ivtSwUxXRzQv5D7minDlAHP4aFW0LYowQ+icxhn1HMd1xGu4K4jHMFXoat3BBCMJUmcxpHDmfSDh3kb2rYrhJaB77muI9YeP1p78vgfT2/v125Sy+qBVy9fjEafxwf7B/tf9kejIsv29vKiyPeKosjzLNvNs6zI8yLP8iy7Tnd3dg7H448f3oN3b9/M5/O6ri/qum3bpmku6vpn00ynl9PptL3qom6aq9nvq7Ztf7Wz2exyejmfzw8Px2Dr9eb3s7Pjo6Pj469lWZ5OqrIsq6qsynJSTb6ddjGpqtPJpGMR5cnJj/PzT9vbfwAzHRmjQDtr+wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8e938844f0ae5d830f0fde43a702375d/c9b55/ReleaseStepPolicy.webp 165w,\n/static/8e938844f0ae5d830f0fde43a702375d/f2908/ReleaseStepPolicy.webp 330w,\n/static/8e938844f0ae5d830f0fde43a702375d/7fed0/ReleaseStepPolicy.webp 586w\"\n              sizes=\"(max-width: 586px) 100vw, 586px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8e938844f0ae5d830f0fde43a702375d/04c57/ReleaseStepPolicy.png 165w,\n/static/8e938844f0ae5d830f0fde43a702375d/d9ecf/ReleaseStepPolicy.png 330w,\n/static/8e938844f0ae5d830f0fde43a702375d/a76f4/ReleaseStepPolicy.png 586w\"\n            sizes=\"(max-width: 586px) 100vw, 586px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8e938844f0ae5d830f0fde43a702375d/a76f4/ReleaseStepPolicy.png\"\n            alt=\"Release Step Policy\"\n            title=\"Release Step specify Branch\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Release Step specify Branch</p></figcaption>\n  </figure></p>\n<p>Once these are set you can set triggers to allow for continuous integration on your build pipeline and release pipeline. Adding these means that the build pipeline will run everytime there is a new commit to your Master branch (note that adding the build validation to your master branch will automatically create a build everytime there is a new Pull request) and a new release deployment will be created with every successful build artifact created. Be sure add a pre-deployment approval gate to your <strong>Terraform Apply stage</strong>, which will allow you to control Terraform deployment changes to your infrastructure.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.72727272727273%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGElEQVR42lWQzW6DMBCEeQ/w7tpe/2EbAk4gTUUu7blVn6BSb32InvPaFZBKjTSn0X6j2anqum5EQ4REKDcRAoKwhlvvcoqpDbkNwVoCIREkAu0iquZDLimyqBmazbrDznDuu+k8O+80azZMkgQC7CQIAlHdfm7fn1+Di8W4QRJu2StszRLj6zBcU1pSXGL7ZG1BzGs2Ss1ayep5ee/6sRyGHMJZqx0GEN6aly5P43Ap46WUMcUu+IN3E2IjNcSjt1wVFCPhgFAIHSLR2uoOp9j1HXtHSkqtSCulZFnbCcIGQVR/769l8N9gxtm3ED5Op2tOk9Yz82z4zHxUEgkVkSSs9gEfZtxgb01sg1XKIHols7NOEj+e/QIPaD6sYgLI+QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/581ad945489a6e79ff73a20562266493/c9b55/ReleasePipelineTerraformApply.webp 165w,\n/static/581ad945489a6e79ff73a20562266493/f2908/ReleasePipelineTerraformApply.webp 330w,\n/static/581ad945489a6e79ff73a20562266493/cc661/ReleasePipelineTerraformApply.webp 660w,\n/static/581ad945489a6e79ff73a20562266493/a66df/ReleasePipelineTerraformApply.webp 990w,\n/static/581ad945489a6e79ff73a20562266493/2768a/ReleasePipelineTerraformApply.webp 1168w\"\n              sizes=\"(max-width: 660px) 100vw, 660px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/581ad945489a6e79ff73a20562266493/04c57/ReleasePipelineTerraformApply.png 165w,\n/static/581ad945489a6e79ff73a20562266493/d9ecf/ReleasePipelineTerraformApply.png 330w,\n/static/581ad945489a6e79ff73a20562266493/1f083/ReleasePipelineTerraformApply.png 660w,\n/static/581ad945489a6e79ff73a20562266493/7a3d6/ReleasePipelineTerraformApply.png 990w,\n/static/581ad945489a6e79ff73a20562266493/8cdda/ReleasePipelineTerraformApply.png 1168w\"\n            sizes=\"(max-width: 660px) 100vw, 660px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/581ad945489a6e79ff73a20562266493/1f083/ReleasePipelineTerraformApply.png\"\n            alt=\"Release Stage Terraform Apply\"\n            title=\"Release Stage Terraform Apply\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Release Stage Terraform Apply</p></figcaption>\n  </figure></p>","categories":["Infrastructure as Code","Terraform","Azure DevOps"],"date":"July 12, 2020","description":"Automate Terraform Infrastructure Deployments with Azure DevOps","id":"6a30b721-e122-5a3f-9b51-473339f9d11d","keywords":["Infrastructure as Code","Azure DevOps","Terraform","Blog"],"slug":"/AutomateTerraformInfrastructureDeployments/","title":"Automate Terraform Infrastructure Deployments","readingTime":{"text":"7 min read"}},{"banner":{"alt":"IaC","caption":"Photo by <u><a href=\"https://unsplash.com/photos/j7q-Z9DV3zw\">Nathan Waters</a></u>","src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#787878","images":{"fallback":{"src":"/static/8dc0d4e035c654e87d0fcf2e7f0047a0/91671/nathan-waters-j7q-Z9DV3zw-unsplash.jpg","srcSet":"/static/8dc0d4e035c654e87d0fcf2e7f0047a0/7e3b4/nathan-waters-j7q-Z9DV3zw-unsplash.jpg 165w,\n/static/8dc0d4e035c654e87d0fcf2e7f0047a0/47f88/nathan-waters-j7q-Z9DV3zw-unsplash.jpg 330w,\n/static/8dc0d4e035c654e87d0fcf2e7f0047a0/91671/nathan-waters-j7q-Z9DV3zw-unsplash.jpg 660w,\n/static/8dc0d4e035c654e87d0fcf2e7f0047a0/5aaff/nathan-waters-j7q-Z9DV3zw-unsplash.jpg 1320w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/8dc0d4e035c654e87d0fcf2e7f0047a0/322ad/nathan-waters-j7q-Z9DV3zw-unsplash.webp 165w,\n/static/8dc0d4e035c654e87d0fcf2e7f0047a0/de3b3/nathan-waters-j7q-Z9DV3zw-unsplash.webp 330w,\n/static/8dc0d4e035c654e87d0fcf2e7f0047a0/2b2b5/nathan-waters-j7q-Z9DV3zw-unsplash.webp 660w,\n/static/8dc0d4e035c654e87d0fcf2e7f0047a0/e36a7/nathan-waters-j7q-Z9DV3zw-unsplash.webp 1320w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":400}}}},"body":"<p>The following is a quick blog of my opinion on Terraform and Azure ARM. I am by far an expert on these tools, having only used Terraform on and off for 2 months and Azure ARM for less than a month. Both have its benefits which I will go on to explain and will reveal my preferred choice and why at the end. I have to also mention that I use Azure as my cloud provider so this will be written from that perspective. So lets begin and compare some points I feel are important for a good tool to use for Infrastructure as code (IaC)</p>\n<h2>Understanding</h2>\n<p>The way that Terraform is written allows for a wider audience to use of all skill levels. The simplicity of the documentation and examples given from it, allow for the user to easily apply Terraform to their own needs. For example the below code allows me to create a Windows Virtual Machine (VM), allocate it's network card, login information, the spec of the virtual machine, data disks and operating disks. It can also do more such as running certain scripts after the VM has been built</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">            resource <span class=\"token string\">\"azurerm_virtual_machine\"</span> <span class=\"token string\">\"main\"</span> <span class=\"token punctuation\">{</span>\r\n              name                  = <span class=\"token string\">\"${var.prefix}-vm\"</span>\r\n              location              = <span class=\"token string\">\"${azurerm_resource_group.main.location}\"</span>\r\n              resource_group_name   = <span class=\"token string\">\"${azurerm_resource_group.main.name}\"</span>\r\n              network_interface_ids = <span class=\"token punctuation\">[</span><span class=\"token string\">\"${azurerm_network_interface.main.id}\"</span><span class=\"token punctuation\">]</span>\r\n              vm_size               = <span class=\"token string\">\"Standard_DS1_v2\"</span>\r\n            \r\n              storage_image_reference <span class=\"token punctuation\">{</span>\r\n                publisher = <span class=\"token string\">\"MicrosoftWindowsServer\"</span>\r\n                offer     = <span class=\"token string\">\"WindowsServer\"</span>\r\n                sku       = <span class=\"token string\">\"2016-Datacenter\"</span>\r\n                version   = <span class=\"token string\">\"latest\"</span>\r\n              <span class=\"token punctuation\">}</span>\r\n              storage_os_disk <span class=\"token punctuation\">{</span>\r\n                name              = <span class=\"token string\">\"myosdisk1\"</span>\r\n                caching           = <span class=\"token string\">\"ReadWrite\"</span>\r\n                create_option     = <span class=\"token string\">\"FromImage\"</span>\r\n                managed_disk_type = <span class=\"token string\">\"Standard_LRS\"</span>\r\n              <span class=\"token punctuation\">}</span>\r\n              os_profile <span class=\"token punctuation\">{</span>\r\n                computer_name  = <span class=\"token string\">\"hostname\"</span>\r\n                admin_username = <span class=\"token string\">\"testadmin\"</span>\r\n                admin_password = <span class=\"token string\">\"Password1234!\"</span>\r\n              <span class=\"token punctuation\">}</span>\r\n              os_profile_linux_config <span class=\"token punctuation\">{</span>\r\n                disable_password_authentication = <span class=\"token boolean\">false</span>\r\n              <span class=\"token punctuation\">}</span>\r\n              tags = <span class=\"token punctuation\">{</span>\r\n                environment = <span class=\"token string\">\"staging\"</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span>\r\n          </code></pre></div>\n<p>As previously mentioned the documentation as for any technology is key to how well the user will understand how to use it. And for Terraform it is excellent (VM documentation here). Terraform uses it's own HCL language the interpolation syntax it utilises is very powerful, and lets you reference variables and attributes with ease. In addition, because it utilises this HCL language it also makes it more readable and user friendly in my opinion than Azure ARM. Azure ARM is written in JSON which, yes it could be argued is also readable but when you see it and try to utilise it for the first time it can be quite interesting to say the least. An example defining a virtual machine resource is below.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">    <span class=\"token punctuation\">{</span>\r\n                  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Microsoft.Compute/virtualMachines\"</span><span class=\"token punctuation\">,</span>\r\n                  <span class=\"token property\">\"apiVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2018-10-01\"</span><span class=\"token punctuation\">,</span>\r\n                  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[variables('vmName')]\"</span><span class=\"token punctuation\">,</span>\r\n                  <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[parameters('location')]\"</span><span class=\"token punctuation\">,</span>\r\n                  <span class=\"token property\">\"dependsOn\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n                    <span class=\"token string\">\"[resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]\"</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token string\">\"[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]\"</span>\r\n                  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n                  <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                    <span class=\"token property\">\"hardwareProfile\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                      <span class=\"token property\">\"vmSize\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[parameters('vmSize')]\"</span>\r\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token property\">\"osProfile\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                      <span class=\"token property\">\"computerName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[variables('vmName')]\"</span><span class=\"token punctuation\">,</span>\r\n                      <span class=\"token property\">\"adminUsername\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[parameters('adminUsername')]\"</span><span class=\"token punctuation\">,</span>\r\n                      <span class=\"token property\">\"adminPassword\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[parameters('adminPassword')]\"</span>\r\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token property\">\"storageProfile\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                      <span class=\"token property\">\"imageReference\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                        <span class=\"token property\">\"publisher\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MicrosoftWindowsServer\"</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token property\">\"offer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"WindowsServer\"</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token property\">\"sku\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[parameters('windowsOSVersion')]\"</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"latest\"</span>\r\n                      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n                      <span class=\"token property\">\"osDisk\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                        <span class=\"token property\">\"createOption\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"FromImage\"</span>\r\n                      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n                      <span class=\"token property\">\"dataDisks\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n                        <span class=\"token punctuation\">{</span>\r\n                          <span class=\"token property\">\"diskSizeGB\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1023</span><span class=\"token punctuation\">,</span>\r\n                          <span class=\"token property\">\"lun\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                          <span class=\"token property\">\"createOption\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Empty\"</span>\r\n                        <span class=\"token punctuation\">}</span>\r\n                      <span class=\"token punctuation\">]</span>\r\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token property\">\"networkProfile\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                      <span class=\"token property\">\"networkInterfaces\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n                        <span class=\"token punctuation\">{</span>\r\n                          <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[resourceId('Microsoft.Network/networkInterfaces',variables('nicName'))]\"</span>\r\n                        <span class=\"token punctuation\">}</span>\r\n                      <span class=\"token punctuation\">]</span>\r\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token property\">\"diagnosticsProfile\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                      <span class=\"token property\">\"bootDiagnostics\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                        <span class=\"token property\">\"enabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token property\">\"storageUri\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[reference(resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))).primaryEndpoints.blob]\"</span>\r\n                      <span class=\"token punctuation\">}</span>\r\n                    <span class=\"token punctuation\">}</span>\r\n                  <span class=\"token punctuation\">}</span>\r\n                <span class=\"token punctuation\">}</span>\r\n              <span class=\"token punctuation\">]</span></code></pre></div>\n<p>Looking at both the Terraform and Azure ARM way of defining a VM, I know which one I prefer myself. <em>Cough</em> Terraform <em>Cough</em></p>\n<h2>Cross-platform</h2>\n<p>As Terraform is not platform specific unlike Azure ARM, it is versatile allowing you to write your infrastructure as code (IaC) for different cloud providers such as Google Cloud Platform (GCP), Amazon Web Services (AWS) or VMware just to name a few. This is useful for businesses that utilise more than one Cloud platform to provide their services, which according to a report is the case <a href=\"https://www.uktech.news/news/uk-businesses-turn-multiple-cloud-providers-20190103\">\"UK businesses turn to multiple cloud providers\"</a> Don't really think I need to write something for Azure ARM for this.</p>\n<h2>Community and support</h2>\n<p>I found that Terraform responds to issues that are reported quite quickly and the support by the community is also a speedy response. <a href=\"https://github.com/terraform-providers\">Click here for issue forum</a>. I personally haven't used the support for Azure ARM, but this is due to the nice error responses that get thrown up when you do try deploy it. Not to say that Terraform doesn't do the same.</p>\n<h2>Easy of deployment/Workflow</h2>\n<p>Talking in terms of using Azure DevOps to deploy. Both I found are quite simple to deploy, although I found that Azure ARM templates are easier to deploy, due to it being deployed on its native platform. Terraform I had to find out how to write the .yaml instruction document to deploy. Azure ARM templates however, do require you to create the resources groups that you are deploying too and for each resource group you'll need a ARM template for. Unlike in Terraform where it would deploy the resource groups itself as defined in the .tf files, you could technically deploy all the resource groups you need and define it in a single .tf file. For tools I always use Visual Studio code, both Terraform and Azure ARM both have extensions installed on it allowing for syntax highlighting and suggestions. Both do a great job.</p>\n<ul>\n<li><a href=\"https://github.com/Azure/vscode-azureterraform\">Terraform Visual Studio Code extension</a></li>\n<li><a href=\"https://github.com/Microsoft/vscode-azurearmtools\">Azure ARM Visual Studio Code extension</a></li>\n</ul>\n<h2>Validation</h2>\n<p>Where both do validate the code for you before you apply the code itself. Although Azure ARM does not validate the deployment and you will have to deploy it to see whether everything is working as planned. Terraform on the other hand, does validate it through it's plan phase, where it checks the status of whats currently deployed in the Terraform state file (Stored as a blob on Azure if deploying to Azure)</p>\n<h2>Maintainability</h2>\n<p>Having used Terraform more and having to maintain its files more I can say that Terraform will seem to me to be easier. As I haven't had to do \"big\" maintenance on Azure ARM yet. But looking at it compared to Terraform I am not looking forward to it at all! This is due to the fact that Terraform is more readable than ARM and has better syntax for defining and calling variables/attributes.</p>\n<h2>Resource Support</h2>\n<p>What I mean by this is whether the tools support the resources that you need to deploy, such as VMs, databases etc. As Terraform is quite a new tool compared to Azure ARM and given that Azure ARM is written by the Cloud provider I use it is bound to be quite up to date with the that can be deployed via IaC. I found that Terraform lacks quite a few new resources, which is not a surprise seeing as it's just nearly on version 2.0. I also found from personal experience that even if it has the resources on there, some attributes that you want to define for that resource is not allowed or given. They have given an alternative such as deploying ARM templates via Terraform (<a href=\"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/template_deployment.html\">Can be seen here</a>, but it seems very long winded to do it like this when you can just do it via Azure ARM templates.</p>\n<h2>Conclusion</h2>\n<p>Overall, though I do love Terraform due to it's readability, ease of use and many of the other biased points that I've stated above. I think going on from here until Terraform is updated I will be using Azure ARM templates, due to the up to date resources and the ease of setting up deployment. I can also see it being used more for CI/CD pipelines going forward and I do love a challenge.... Disclaimer: This was written at 4am so please excuse any errors that are in this! Yours faithfully, An Aspiring DevOps Guy</p>","categories":["Infrastructure as Code","Terraform"],"date":"June 12, 2020","description":"Terraform Vs ARM","id":"22211907-07a3-5bf0-9893-cfdbc83714c5","keywords":["Infrastructure as Code","Azure","ARM","Terraform","Blog"],"slug":"/TerraformVsARM/","title":"Terraform Vs ARM","readingTime":{"text":"7 min read"}}]}},"staticQueryHashes":["172304273","1764120992","2442753764","2572006233","3525841079","513457919","540466502","597217301","948380417"],"slicesMap":{}}